"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/tools/[tool]/route";
exports.ids = ["app/api/tools/[tool]/route"];
exports.modules = {

/***/ "better-sqlite3":
/*!*********************************!*\
  !*** external "better-sqlite3" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("better-sqlite3");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftools%2F%5Btool%5D%2Froute&page=%2Fapi%2Ftools%2F%5Btool%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftools%2F%5Btool%5D%2Froute.ts&appDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftools%2F%5Btool%5D%2Froute&page=%2Fapi%2Ftools%2F%5Btool%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftools%2F%5Btool%5D%2Froute.ts&appDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_eke_Documents_Uap_Progra_4_Progra_3_4_app_api_tools_tool_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/tools/[tool]/route.ts */ \"(rsc)/./app/api/tools/[tool]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/tools/[tool]/route\",\n        pathname: \"/api/tools/[tool]\",\n        filename: \"route\",\n        bundlePath: \"app/api/tools/[tool]/route\"\n    },\n    resolvedPagePath: \"/home/eke/Documents/Uap/Progra 4/Progra-3-4/app/api/tools/[tool]/route.ts\",\n    nextConfigOutput,\n    userland: _home_eke_Documents_Uap_Progra_4_Progra_3_4_app_api_tools_tool_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/tools/[tool]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vbmV4dEAxNS4wLjAtY2FuYXJ5LjBfQG9wZW50ZWxlbWV0cnkrYXBpQDEuOS4wX3JlYWN0LWRvbUAxOS4wLjAtcmMtZjk5NDczN2QxNC0yMDI0MDUyMl9yX2JkMmVkOGE3ZDViMDY0NTc2OTBkMjdiZGUwYTgxZDYxL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtYXBwLWxvYWRlci5qcz9uYW1lPWFwcCUyRmFwaSUyRnRvb2xzJTJGJTVCdG9vbCU1RCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGdG9vbHMlMkYlNUJ0b29sJTVEJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdG9vbHMlMkYlNUJ0b29sJTVEJTJGcm91dGUudHMmYXBwRGlyPSUyRmhvbWUlMkZla2UlMkZEb2N1bWVudHMlMkZVYXAlMkZQcm9ncmElMjA0JTJGUHJvZ3JhLTMtNCUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGaG9tZSUyRmVrZSUyRkRvY3VtZW50cyUyRlVhcCUyRlByb2dyYSUyMDQlMkZQcm9ncmEtMy00JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUN5QjtBQUN0RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWJvb2stYWR2aXNvci8/NzQwNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvaG9tZS9la2UvRG9jdW1lbnRzL1VhcC9Qcm9ncmEgNC9Qcm9ncmEtMy00L2FwcC9hcGkvdG9vbHMvW3Rvb2xdL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90b29scy9bdG9vbF0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS90b29scy9bdG9vbF1cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Rvb2xzL1t0b29sXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9ob21lL2VrZS9Eb2N1bWVudHMvVWFwL1Byb2dyYSA0L1Byb2dyYS0zLTQvYXBwL2FwaS90b29scy9bdG9vbF0vcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3Rvb2xzL1t0b29sXS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftools%2F%5Btool%5D%2Froute&page=%2Fapi%2Ftools%2F%5Btool%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftools%2F%5Btool%5D%2Froute.ts&appDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/tools/[tool]/route.ts":
/*!***************************************!*\
  !*** ./app/api/tools/[tool]/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _src_server_tools__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../src/server/tools */ \"(rsc)/./src/server/tools.ts\");\n/* harmony import */ var _src_server_rateLimit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../src/server/rateLimit */ \"(rsc)/./src/server/rateLimit.ts\");\n\n\n\nconst TOOL_MAP = {\n    searchBooks: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.searchBooks,\n    getBookDetails: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.getBookDetails,\n    addToReadingList: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.addToReadingList,\n    getReadingList: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.getReadingList,\n    markAsRead: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.markAsRead,\n    getReadingStats: _src_server_tools__WEBPACK_IMPORTED_MODULE_1__.getReadingStats\n};\nconst getUserId = (request)=>(request.headers.get('x-user-id') ?? 'demo-user').replace(/[^a-zA-Z0-9-_]/g, '').slice(0, 64) || 'demo-user';\nconst getRateLimitKey = (request)=>{\n    const ip = request.headers.get('x-forwarded-for')?.split(',')[0]?.trim() || request.headers.get('x-real-ip') || 'unknown-ip';\n    return `${ip}:${getUserId(request)}`;\n};\nasync function POST(request, { params }) {\n    const toolName = params.tool;\n    if (!toolName || !(toolName in TOOL_MAP)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Herramienta no permitida'\n        }, {\n            status: 404\n        });\n    }\n    try {\n        const limit = (0,_src_server_rateLimit__WEBPACK_IMPORTED_MODULE_2__.rateLimit)(getRateLimitKey(request));\n        if (!limit.success) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Se alcanzó el límite de solicitudes. Intenta nuevamente más tarde.'\n            }, {\n                status: 429\n            });\n        }\n        const body = await request.json();\n        const userId = getUserId(request);\n        const executor = TOOL_MAP[toolName];\n        const result = toolName === 'searchBooks' || toolName === 'getBookDetails' ? await executor(body) : await executor(body, userId);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            tool: toolName,\n            result\n        });\n    } catch (error) {\n        const message = error?.issues?.[0]?.message || error?.message || 'No pudimos procesar la solicitud. Verifica los parámetros e intenta nuevamente.';\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: message\n        }, {\n            status: 400\n        });\n    }\n}\nfunction GET() {\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        tools: Object.keys(TOOL_MAP),\n        usage: 'Envía un POST con JSON válido a /api/tools/{toolName}'\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3Rvb2xzL1t0b29sXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUF3RDtBQVFsQjtBQUN1QjtBQUU3RCxNQUFNUSxXQUFXO0lBQ2ZGLFdBQVdBLDREQUFBQTtJQUNYSixjQUFjQSwrREFBQUE7SUFDZEQsZ0JBQWdCQSxpRUFBQUE7SUFDaEJFLGNBQWNBLCtEQUFBQTtJQUNkRSxVQUFVQSwyREFBQUE7SUFDVkQsZUFBZUEsZ0VBQUFBO0FBQ2pCO0FBSUEsTUFBTUssWUFBWSxDQUFDQyxVQUNqQixDQUFDQSxRQUFRQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxnQkFBZ0IsV0FBVSxFQUFHQyxPQUFPLENBQUMsbUJBQW1CLElBQUlDLEtBQUssQ0FBQyxHQUFHLE9BQU87QUFFbkcsTUFBTUMsa0JBQWtCLENBQUNMO0lBQ3ZCLE1BQU1NLEtBQ0pOLFFBQVFDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLG9CQUFvQkssTUFBTSxJQUFJLENBQUMsRUFBRSxFQUFFQyxVQUFVUixRQUFRQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxnQkFBZ0I7SUFDdkcsT0FBTyxDQUFDLEVBQUVJLEdBQUcsQ0FBQyxFQUFFUCxVQUFVQyxTQUFTLENBQUM7QUFDdEM7QUFFTyxlQUFlUyxLQUFLVCxPQUFvQixFQUFFLEVBQUVVLE1BQU0sRUFBa0M7SUFDekYsTUFBTUMsV0FBV0QsT0FBT0UsSUFBSTtJQUM1QixJQUFJLENBQUNELFlBQVksQ0FBRUEsQ0FBQUEsWUFBWWIsUUFBTyxHQUFJO1FBQ3hDLE9BQU9SLHFEQUFZQSxDQUFDdUIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBMkIsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDaEY7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsUUFBUW5CLGdFQUFTQSxDQUFDUSxnQkFBZ0JMO1FBQ3hDLElBQUksQ0FBQ2dCLE1BQU1DLE9BQU8sRUFBRTtZQUNsQixPQUFPM0IscURBQVlBLENBQUN1QixJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXFFLEdBQzlFO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNRyxPQUFPLE1BQU1sQixRQUFRYSxJQUFJO1FBQy9CLE1BQU1NLFNBQVNwQixVQUFVQztRQUN6QixNQUFNb0IsV0FBV3RCLFFBQVEsQ0FBQ2EsU0FBUztRQUNuQyxNQUFNVSxTQUNKVixhQUFhLGlCQUFpQkEsYUFBYSxtQkFDdkMsTUFBTVMsU0FBU0YsUUFDZixNQUFNRSxTQUFTRixNQUFNQztRQUUzQixPQUFPN0IscURBQVlBLENBQUN1QixJQUFJLENBQUM7WUFBRUQsTUFBTUQ7WUFBVVU7UUFBTztJQUNwRCxFQUFFLE9BQU9QLE9BQVk7UUFDbkIsTUFBTVEsVUFDSlIsT0FBT1MsUUFBUSxDQUFDLEVBQUUsRUFBRUQsV0FDcEJSLE9BQU9RLFdBQ1A7UUFDRixPQUFPaEMscURBQVlBLENBQUN1QixJQUFJLENBQUM7WUFBRUMsT0FBT1E7UUFBUSxHQUFHO1lBQUVQLFFBQVE7UUFBSTtJQUM3RDtBQUNGO0FBRU8sU0FBU1M7SUFDZCxPQUFPbEMscURBQVlBLENBQUN1QixJQUFJLENBQUM7UUFDdkJZLE9BQU9DLE9BQU9DLElBQUksQ0FBQzdCO1FBQ25COEIsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1ib29rLWFkdmlzb3IvLi9hcHAvYXBpL3Rvb2xzL1t0b29sXS9yb3V0ZS50cz9mNGEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQge1xuICBhZGRUb1JlYWRpbmdMaXN0LFxuICBnZXRCb29rRGV0YWlscyxcbiAgZ2V0UmVhZGluZ0xpc3QsXG4gIGdldFJlYWRpbmdTdGF0cyxcbiAgbWFya0FzUmVhZCxcbiAgc2VhcmNoQm9va3MsXG59IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9zZXJ2ZXIvdG9vbHMnO1xuaW1wb3J0IHsgcmF0ZUxpbWl0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL3NlcnZlci9yYXRlTGltaXQnO1xuXG5jb25zdCBUT09MX01BUCA9IHtcbiAgc2VhcmNoQm9va3MsXG4gIGdldEJvb2tEZXRhaWxzLFxuICBhZGRUb1JlYWRpbmdMaXN0LFxuICBnZXRSZWFkaW5nTGlzdCxcbiAgbWFya0FzUmVhZCxcbiAgZ2V0UmVhZGluZ1N0YXRzLFxufTtcblxudHlwZSBUb29sTmFtZSA9IGtleW9mIHR5cGVvZiBUT09MX01BUDtcblxuY29uc3QgZ2V0VXNlcklkID0gKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSA9PlxuICAocmVxdWVzdC5oZWFkZXJzLmdldCgneC11c2VyLWlkJykgPz8gJ2RlbW8tdXNlcicpLnJlcGxhY2UoL1teYS16QS1aMC05LV9dL2csICcnKS5zbGljZSgwLCA2NCkgfHwgJ2RlbW8tdXNlcic7XG5cbmNvbnN0IGdldFJhdGVMaW1pdEtleSA9IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgPT4ge1xuICBjb25zdCBpcCA9XG4gICAgcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJyk/LnNwbGl0KCcsJylbMF0/LnRyaW0oKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKSB8fCAndW5rbm93bi1pcCc7XG4gIHJldHVybiBgJHtpcH06JHtnZXRVc2VySWQocmVxdWVzdCl9YDtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyB0b29sOiBUb29sTmFtZSB9IH0pIHtcbiAgY29uc3QgdG9vbE5hbWUgPSBwYXJhbXMudG9vbDtcbiAgaWYgKCF0b29sTmFtZSB8fCAhKHRvb2xOYW1lIGluIFRPT0xfTUFQKSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSGVycmFtaWVudGEgbm8gcGVybWl0aWRhJyB9LCB7IHN0YXR1czogNDA0IH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBsaW1pdCA9IHJhdGVMaW1pdChnZXRSYXRlTGltaXRLZXkocmVxdWVzdCkpO1xuICAgIGlmICghbGltaXQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU2UgYWxjYW56w7MgZWwgbMOtbWl0ZSBkZSBzb2xpY2l0dWRlcy4gSW50ZW50YSBudWV2YW1lbnRlIG3DoXMgdGFyZGUuJyB9LFxuICAgICAgICB7IHN0YXR1czogNDI5IH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcbiAgICBjb25zdCB1c2VySWQgPSBnZXRVc2VySWQocmVxdWVzdCk7XG4gICAgY29uc3QgZXhlY3V0b3IgPSBUT09MX01BUFt0b29sTmFtZV07XG4gICAgY29uc3QgcmVzdWx0ID1cbiAgICAgIHRvb2xOYW1lID09PSAnc2VhcmNoQm9va3MnIHx8IHRvb2xOYW1lID09PSAnZ2V0Qm9va0RldGFpbHMnXG4gICAgICAgID8gYXdhaXQgZXhlY3V0b3IoYm9keSlcbiAgICAgICAgOiBhd2FpdCBleGVjdXRvcihib2R5LCB1c2VySWQpO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgdG9vbDogdG9vbE5hbWUsIHJlc3VsdCB9KTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnN0IG1lc3NhZ2UgPVxuICAgICAgZXJyb3I/Lmlzc3Vlcz8uWzBdPy5tZXNzYWdlIHx8XG4gICAgICBlcnJvcj8ubWVzc2FnZSB8fFxuICAgICAgJ05vIHB1ZGltb3MgcHJvY2VzYXIgbGEgc29saWNpdHVkLiBWZXJpZmljYSBsb3MgcGFyw6FtZXRyb3MgZSBpbnRlbnRhIG51ZXZhbWVudGUuJztcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogbWVzc2FnZSB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBHRVQoKSB7XG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgdG9vbHM6IE9iamVjdC5rZXlzKFRPT0xfTUFQKSxcbiAgICB1c2FnZTogJ0VudsOtYSB1biBQT1NUIGNvbiBKU09OIHbDoWxpZG8gYSAvYXBpL3Rvb2xzL3t0b29sTmFtZX0nLFxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJhZGRUb1JlYWRpbmdMaXN0IiwiZ2V0Qm9va0RldGFpbHMiLCJnZXRSZWFkaW5nTGlzdCIsImdldFJlYWRpbmdTdGF0cyIsIm1hcmtBc1JlYWQiLCJzZWFyY2hCb29rcyIsInJhdGVMaW1pdCIsIlRPT0xfTUFQIiwiZ2V0VXNlcklkIiwicmVxdWVzdCIsImhlYWRlcnMiLCJnZXQiLCJyZXBsYWNlIiwic2xpY2UiLCJnZXRSYXRlTGltaXRLZXkiLCJpcCIsInNwbGl0IiwidHJpbSIsIlBPU1QiLCJwYXJhbXMiLCJ0b29sTmFtZSIsInRvb2wiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJsaW1pdCIsInN1Y2Nlc3MiLCJib2R5IiwidXNlcklkIiwiZXhlY3V0b3IiLCJyZXN1bHQiLCJtZXNzYWdlIiwiaXNzdWVzIiwiR0VUIiwidG9vbHMiLCJPYmplY3QiLCJrZXlzIiwidXNhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/tools/[tool]/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/datastore.ts":
/*!*********************************!*\
  !*** ./src/server/datastore.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addBook: () => (/* binding */ addBook),\n/* harmony export */   getStats: () => (/* binding */ getStats),\n/* harmony export */   listBooks: () => (/* binding */ listBooks),\n/* harmony export */   markBookAsRead: () => (/* binding */ markBookAsRead)\n/* harmony export */ });\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./db */ \"(rsc)/./src/server/db.ts\");\n\nconst serializeArray = (value)=>value ? JSON.stringify(value.slice(0, 20)) : null;\nconst deserializeArray = (value)=>value ? JSON.parse(value) : undefined;\nconst addBook = (userId, entry)=>{\n    const safeUser = (0,_db__WEBPACK_IMPORTED_MODULE_0__.ensureUser)(userId);\n    try {\n        const stmt = _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare(`INSERT INTO reading_list (user_id, book_id, priority, notes, added_at, status, title, authors, thumbnail)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`);\n        stmt.run(safeUser, entry.bookId, entry.priority, entry.notes, entry.addedAt, entry.status, entry.title ?? null, entry.authors ? JSON.stringify(entry.authors) : null, entry.thumbnail ?? null);\n    } catch (error) {\n        if (error?.code === 'SQLITE_CONSTRAINT_UNIQUE') {\n            return {\n                added: false,\n                reason: 'El libro ya existe en tu lista.'\n            };\n        }\n        throw error;\n    }\n    return {\n        added: true,\n        item: entry\n    };\n};\nconst listBooks = (userId, filter, limit)=>{\n    const safeUser = (0,_db__WEBPACK_IMPORTED_MODULE_0__.ensureUser)(userId);\n    const filters = [];\n    const params = [\n        safeUser\n    ];\n    if (filter && filter !== 'all') {\n        filters.push('priority = ?');\n        params.push(filter);\n    }\n    const where = filters.length ? `AND ${filters.join(' AND ')}` : '';\n    const limitClause = limit ? `LIMIT ${limit}` : '';\n    const rows = _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare(`SELECT id, book_id, priority, notes, added_at, status, rating, review, date_finished, title, authors, thumbnail\n       FROM reading_list\n       WHERE user_id = ? ${where}\n       ORDER BY added_at DESC ${limitClause}`).all(...params);\n    return rows.map((row)=>({\n            id: row.id,\n            bookId: row.book_id,\n            priority: row.priority,\n            notes: row.notes ?? undefined,\n            addedAt: row.added_at,\n            status: row.status,\n            rating: row.rating ?? undefined,\n            review: row.review ?? undefined,\n            dateFinished: row.date_finished ?? undefined,\n            title: row.title ?? undefined,\n            authors: deserializeArray(row.authors ?? null),\n            thumbnail: row.thumbnail ?? undefined\n        }));\n};\nconst markBookAsRead = (userId, bookId, rating, review, dateFinished, details)=>{\n    const safeUser = (0,_db__WEBPACK_IMPORTED_MODULE_0__.ensureUser)(userId);\n    const tx = _db__WEBPACK_IMPORTED_MODULE_0__.db.transaction(()=>{\n        const existing = _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare('SELECT id, title, authors, thumbnail FROM reading_list WHERE user_id = ? AND book_id = ?').get(safeUser, bookId);\n        if (!existing) return false;\n        _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare(`UPDATE reading_list\n       SET status = 'read', rating = ?, review = ?, date_finished = ?\n       WHERE user_id = ? AND book_id = ?`).run(rating ?? null, review ?? null, dateFinished ?? new Date().toISOString(), safeUser, bookId);\n        const targetDetails = details ?? null;\n        _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare(`INSERT OR REPLACE INTO read_books (user_id, book_id, rating, review, date_finished, page_count, authors, categories, title, thumbnail)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`).run(safeUser, bookId, rating ?? null, review ?? null, dateFinished ?? new Date().toISOString(), targetDetails?.pageCount ?? null, serializeArray(targetDetails?.authors), serializeArray(targetDetails?.categories), targetDetails?.title ?? existing?.title ?? null, targetDetails?.thumbnail ?? existing?.thumbnail ?? null);\n        return true;\n    });\n    return tx();\n};\nconst isWithinPeriod = (date, period)=>{\n    if (period === 'all-time') return true;\n    if (!date) return false;\n    const current = new Date();\n    const target = new Date(date);\n    if (Number.isNaN(target.getTime())) return false;\n    if (period === 'year') return target.getFullYear() === current.getFullYear();\n    if (period === 'month') return target.getFullYear() === current.getFullYear() && target.getMonth() === current.getMonth();\n    const diff = (current.getTime() - target.getTime()) / (1000 * 60 * 60 * 24);\n    return diff <= 7;\n};\nconst getStats = (userId, period = 'all-time')=>{\n    const safeUser = (0,_db__WEBPACK_IMPORTED_MODULE_0__.ensureUser)(userId);\n    const readRows = _db__WEBPACK_IMPORTED_MODULE_0__.db.prepare(`SELECT book_id, rating, review, date_finished, page_count, authors, categories, title, thumbnail\n       FROM read_books WHERE user_id = ? ORDER BY date_finished DESC`).all(safeUser).filter((row)=>isWithinPeriod(row.date_finished ?? null, period));\n    const totalRead = readRows.length;\n    const totalPages = readRows.reduce((sum, row)=>sum + (row.page_count || 0), 0);\n    const rated = readRows.filter((row)=>row.rating != null);\n    const averageRating = rated.length ? rated.reduce((sum, row)=>sum + Number(row.rating), 0) / rated.length : undefined;\n    const genres = {};\n    const authors = {};\n    const byPeriod = {};\n    const toKey = (date)=>{\n        if (!date) return 'unknown';\n        const parsed = new Date(date);\n        if (Number.isNaN(parsed.getTime())) return 'unknown';\n        return parsed.toISOString().slice(0, 10);\n    };\n    readRows.forEach((row)=>{\n        const dayKey = toKey(row.date_finished);\n        byPeriod[dayKey] = (byPeriod[dayKey] || 0) + 1;\n        const rowGenres = deserializeArray(row.categories ?? null) ?? [];\n        rowGenres.forEach((genre)=>{\n            genres[genre] = (genres[genre] || 0) + 1;\n        });\n        const rowAuthors = deserializeArray(row.authors ?? null) ?? [];\n        rowAuthors.forEach((author)=>{\n            authors[author] = (authors[author] || 0) + 1;\n        });\n    });\n    const sortedDates = Object.keys(byPeriod).filter((key)=>key !== 'unknown').sort((a, b)=>a > b ? -1 : 1);\n    let streakDays = 0;\n    let previous = null;\n    for (const key of sortedDates){\n        const current = new Date(key);\n        if (!previous) {\n            streakDays = 1;\n            previous = current;\n            continue;\n        }\n        const diff = (previous.getTime() - current.getTime()) / (1000 * 60 * 60 * 24);\n        if (diff === 1) {\n            streakDays += 1;\n        } else if (diff > 1) {\n            break;\n        }\n        previous = current;\n    }\n    return {\n        totalRead,\n        totalPages,\n        averageRating,\n        genres,\n        authors,\n        byPeriod,\n        streakDays\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RhdGFzdG9yZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFzQztBQUt0QyxNQUFNRSxpQkFBaUIsQ0FBQ0MsUUFBc0JBLFFBQVFDLEtBQUtDLFNBQVMsQ0FBQ0YsTUFBTUcsS0FBSyxDQUFDLEdBQUcsT0FBTztBQUMzRixNQUFNQyxtQkFBbUIsQ0FBQ0osUUFBMEJBLFFBQVNDLEtBQUtJLEtBQUssQ0FBQ0wsU0FBc0JNO0FBRXZGLE1BQU1DLFVBQVUsQ0FDckJDLFFBQ0FDO0lBRUEsTUFBTUMsV0FBV1osK0NBQVVBLENBQUNVO0lBRTVCLElBQUk7UUFDRixNQUFNRyxPQUFPZCxtQ0FBRUEsQ0FBQ2UsT0FBTyxDQUNyQixDQUFDO3lDQUNrQyxDQUFDO1FBRXRDRCxLQUFLRSxHQUFHLENBQ05ILFVBQ0FELE1BQU1LLE1BQU0sRUFDWkwsTUFBTU0sUUFBUSxFQUNkTixNQUFNTyxLQUFLLEVBQ1hQLE1BQU1RLE9BQU8sRUFDYlIsTUFBTVMsTUFBTSxFQUNaVCxNQUFNVSxLQUFLLElBQUksTUFDZlYsTUFBTVcsT0FBTyxHQUFHbkIsS0FBS0MsU0FBUyxDQUFDTyxNQUFNVyxPQUFPLElBQUksTUFDaERYLE1BQU1ZLFNBQVMsSUFBSTtJQUV2QixFQUFFLE9BQU9DLE9BQVk7UUFDbkIsSUFBSUEsT0FBT0MsU0FBUyw0QkFBNEI7WUFDOUMsT0FBTztnQkFBRUMsT0FBTztnQkFBT0MsUUFBUTtZQUFrQztRQUNuRTtRQUNBLE1BQU1IO0lBQ1I7SUFFQSxPQUFPO1FBQUVFLE9BQU87UUFBTUUsTUFBTWpCO0lBQU07QUFDcEMsRUFBRTtBQUVLLE1BQU1rQixZQUFZLENBQ3ZCbkIsUUFDQW9CLFFBQ0FDO0lBRUEsTUFBTW5CLFdBQVdaLCtDQUFVQSxDQUFDVTtJQUM1QixNQUFNc0IsVUFBb0IsRUFBRTtJQUM1QixNQUFNQyxTQUE4QjtRQUFDckI7S0FBUztJQUU5QyxJQUFJa0IsVUFBVUEsV0FBVyxPQUFPO1FBQzlCRSxRQUFRRSxJQUFJLENBQUM7UUFDYkQsT0FBT0MsSUFBSSxDQUFDSjtJQUNkO0lBRUEsTUFBTUssUUFBUUgsUUFBUUksTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFSixRQUFRSyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUc7SUFDaEUsTUFBTUMsY0FBY1AsUUFBUSxDQUFDLE1BQU0sRUFBRUEsTUFBTSxDQUFDLEdBQUc7SUFFL0MsTUFBTVEsT0FBT3hDLG1DQUFFQSxDQUNaZSxPQUFPLENBQ04sQ0FBQzs7eUJBRWtCLEVBQUVxQixNQUFNOzhCQUNILEVBQUVHLFlBQVksQ0FBQyxFQUV4Q0UsR0FBRyxJQUFJUDtJQUVWLE9BQU9NLEtBQUtFLEdBQUcsQ0FBQyxDQUFDQyxNQUFTO1lBQ3hCQyxJQUFJRCxJQUFJQyxFQUFFO1lBQ1YzQixRQUFRMEIsSUFBSUUsT0FBTztZQUNuQjNCLFVBQVV5QixJQUFJekIsUUFBUTtZQUN0QkMsT0FBT3dCLElBQUl4QixLQUFLLElBQUlWO1lBQ3BCVyxTQUFTdUIsSUFBSUcsUUFBUTtZQUNyQnpCLFFBQVFzQixJQUFJdEIsTUFBTTtZQUNsQjBCLFFBQVFKLElBQUlJLE1BQU0sSUFBSXRDO1lBQ3RCdUMsUUFBUUwsSUFBSUssTUFBTSxJQUFJdkM7WUFDdEJ3QyxjQUFjTixJQUFJTyxhQUFhLElBQUl6QztZQUNuQ2EsT0FBT3FCLElBQUlyQixLQUFLLElBQUliO1lBQ3BCYyxTQUFTaEIsaUJBQWlCb0MsSUFBSXBCLE9BQU8sSUFBSTtZQUN6Q0MsV0FBV21CLElBQUluQixTQUFTLElBQUlmO1FBQzlCO0FBQ0YsRUFBRTtBQUVLLE1BQU0wQyxpQkFBaUIsQ0FDNUJ4QyxRQUNBTSxRQUNBOEIsUUFDQUMsUUFDQUMsY0FDQUc7SUFFQSxNQUFNdkMsV0FBV1osK0NBQVVBLENBQUNVO0lBQzVCLE1BQU0wQyxLQUFLckQsbUNBQUVBLENBQUNzRCxXQUFXLENBQUM7UUFDeEIsTUFBTUMsV0FBV3ZELG1DQUFFQSxDQUNoQmUsT0FBTyxDQUFDLDRGQUNSeUMsR0FBRyxDQUFDM0MsVUFBVUk7UUFFakIsSUFBSSxDQUFDc0MsVUFBVSxPQUFPO1FBRXRCdkQsbUNBQUVBLENBQUNlLE9BQU8sQ0FDUixDQUFDOzt3Q0FFaUMsQ0FBQyxFQUNuQ0MsR0FBRyxDQUFDK0IsVUFBVSxNQUFNQyxVQUFVLE1BQU1DLGdCQUFnQixJQUFJUSxPQUFPQyxXQUFXLElBQUk3QyxVQUFVSTtRQUUxRixNQUFNMEMsZ0JBQWdCUCxXQUFXO1FBQ2pDcEQsbUNBQUVBLENBQUNlLE9BQU8sQ0FDUixDQUFDOzRDQUNxQyxDQUFDLEVBQ3ZDQyxHQUFHLENBQ0hILFVBQ0FJLFFBQ0E4QixVQUFVLE1BQ1ZDLFVBQVUsTUFDVkMsZ0JBQWdCLElBQUlRLE9BQU9DLFdBQVcsSUFDdENDLGVBQWVDLGFBQWEsTUFDNUIxRCxlQUFleUQsZUFBZXBDLFVBQzlCckIsZUFBZXlELGVBQWVFLGFBQzlCRixlQUFlckMsU0FBU2lDLFVBQVVqQyxTQUFTLE1BQzNDcUMsZUFBZW5DLGFBQWErQixVQUFVL0IsYUFBYTtRQUdyRCxPQUFPO0lBQ1Q7SUFFQSxPQUFPNkI7QUFDVCxFQUFFO0FBSUYsTUFBTVMsaUJBQWlCLENBQUNDLE1BQXFCQztJQUMzQyxJQUFJQSxXQUFXLFlBQVksT0FBTztJQUNsQyxJQUFJLENBQUNELE1BQU0sT0FBTztJQUNsQixNQUFNRSxVQUFVLElBQUlSO0lBQ3BCLE1BQU1TLFNBQVMsSUFBSVQsS0FBS007SUFDeEIsSUFBSUksT0FBT0MsS0FBSyxDQUFDRixPQUFPRyxPQUFPLEtBQUssT0FBTztJQUUzQyxJQUFJTCxXQUFXLFFBQVEsT0FBT0UsT0FBT0ksV0FBVyxPQUFPTCxRQUFRSyxXQUFXO0lBQzFFLElBQUlOLFdBQVcsU0FDYixPQUFPRSxPQUFPSSxXQUFXLE9BQU9MLFFBQVFLLFdBQVcsTUFBTUosT0FBT0ssUUFBUSxPQUFPTixRQUFRTSxRQUFRO0lBRWpHLE1BQU1DLE9BQU8sQ0FBQ1AsUUFBUUksT0FBTyxLQUFLSCxPQUFPRyxPQUFPLEVBQUMsSUFBTSxRQUFPLEtBQUssS0FBSyxFQUFDO0lBQ3pFLE9BQU9HLFFBQVE7QUFDakI7QUFFTyxNQUFNQyxXQUFXLENBQUM5RCxRQUFnQnFELFNBQWlCLFVBQVU7SUFDbEUsTUFBTW5ELFdBQVdaLCtDQUFVQSxDQUFDVTtJQUM1QixNQUFNK0QsV0FBVzFFLG1DQUFFQSxDQUNoQmUsT0FBTyxDQUNOLENBQUM7b0VBQzZELENBQUMsRUFFaEUwQixHQUFHLENBQUM1QixVQUNKa0IsTUFBTSxDQUFDLENBQUNZLE1BQVFtQixlQUFlbkIsSUFBSU8sYUFBYSxJQUFJLE1BQU1jO0lBRTdELE1BQU1XLFlBQVlELFNBQVNyQyxNQUFNO0lBQ2pDLE1BQU11QyxhQUFhRixTQUFTRyxNQUFNLENBQUMsQ0FBQ0MsS0FBS25DLE1BQVFtQyxNQUFPbkMsQ0FBQUEsSUFBSW9DLFVBQVUsSUFBSSxJQUFJO0lBQzlFLE1BQU1DLFFBQVFOLFNBQVMzQyxNQUFNLENBQUMsQ0FBQ1ksTUFBUUEsSUFBSUksTUFBTSxJQUFJO0lBQ3JELE1BQU1rQyxnQkFBZ0JELE1BQU0zQyxNQUFNLEdBQzlCMkMsTUFBTUgsTUFBTSxDQUFDLENBQUNDLEtBQUtuQyxNQUFRbUMsTUFBTVgsT0FBT3hCLElBQUlJLE1BQU0sR0FBRyxLQUFLaUMsTUFBTTNDLE1BQU0sR0FDdEU1QjtJQUVKLE1BQU15RSxTQUFpQyxDQUFDO0lBQ3hDLE1BQU0zRCxVQUFrQyxDQUFDO0lBQ3pDLE1BQU00RCxXQUFtQyxDQUFDO0lBRTFDLE1BQU1DLFFBQVEsQ0FBQ3JCO1FBQ2IsSUFBSSxDQUFDQSxNQUFNLE9BQU87UUFDbEIsTUFBTXNCLFNBQVMsSUFBSTVCLEtBQUtNO1FBQ3hCLElBQUlJLE9BQU9DLEtBQUssQ0FBQ2lCLE9BQU9oQixPQUFPLEtBQUssT0FBTztRQUMzQyxPQUFPZ0IsT0FBTzNCLFdBQVcsR0FBR3BELEtBQUssQ0FBQyxHQUFHO0lBQ3ZDO0lBRUFvRSxTQUFTWSxPQUFPLENBQUMsQ0FBQzNDO1FBQ2hCLE1BQU00QyxTQUFTSCxNQUFNekMsSUFBSU8sYUFBYTtRQUN0Q2lDLFFBQVEsQ0FBQ0ksT0FBTyxHQUFHLENBQUNKLFFBQVEsQ0FBQ0ksT0FBTyxJQUFJLEtBQUs7UUFFN0MsTUFBTUMsWUFBWWpGLGlCQUFpQm9DLElBQUlrQixVQUFVLElBQUksU0FBUyxFQUFFO1FBQ2hFMkIsVUFBVUYsT0FBTyxDQUFDLENBQUNHO1lBQ2pCUCxNQUFNLENBQUNPLE1BQU0sR0FBRyxDQUFDUCxNQUFNLENBQUNPLE1BQU0sSUFBSSxLQUFLO1FBQ3pDO1FBRUEsTUFBTUMsYUFBYW5GLGlCQUFpQm9DLElBQUlwQixPQUFPLElBQUksU0FBUyxFQUFFO1FBQzlEbUUsV0FBV0osT0FBTyxDQUFDLENBQUNLO1lBQ2xCcEUsT0FBTyxDQUFDb0UsT0FBTyxHQUFHLENBQUNwRSxPQUFPLENBQUNvRSxPQUFPLElBQUksS0FBSztRQUM3QztJQUNGO0lBRUEsTUFBTUMsY0FBY0MsT0FBT0MsSUFBSSxDQUFDWCxVQUM3QnBELE1BQU0sQ0FBQyxDQUFDZ0UsTUFBUUEsUUFBUSxXQUN4QkMsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU9ELElBQUlDLElBQUksQ0FBQyxJQUFJO0lBRWhDLElBQUlDLGFBQWE7SUFDakIsSUFBSUMsV0FBd0I7SUFDNUIsS0FBSyxNQUFNTCxPQUFPSCxZQUFhO1FBQzdCLE1BQU0zQixVQUFVLElBQUlSLEtBQUtzQztRQUN6QixJQUFJLENBQUNLLFVBQVU7WUFDYkQsYUFBYTtZQUNiQyxXQUFXbkM7WUFDWDtRQUNGO1FBQ0EsTUFBTU8sT0FBTyxDQUFDNEIsU0FBUy9CLE9BQU8sS0FBS0osUUFBUUksT0FBTyxFQUFDLElBQU0sUUFBTyxLQUFLLEtBQUssRUFBQztRQUMzRSxJQUFJRyxTQUFTLEdBQUc7WUFDZDJCLGNBQWM7UUFDaEIsT0FBTyxJQUFJM0IsT0FBTyxHQUFHO1lBQ25CO1FBQ0Y7UUFDQTRCLFdBQVduQztJQUNiO0lBRUEsT0FBTztRQUNMVTtRQUNBQztRQUNBSztRQUNBQztRQUNBM0Q7UUFDQTREO1FBQ0FnQjtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWJvb2stYWR2aXNvci8uL3NyYy9zZXJ2ZXIvZGF0YXN0b3JlLnRzP2YwOGEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGIsIGVuc3VyZVVzZXIgfSBmcm9tICcuL2RiJztcbmltcG9ydCB7IEJvb2tEZXRhaWxzLCBSZWFkaW5nTGlzdEVudHJ5LCBSZWFkaW5nU3RhdHMgfSBmcm9tICcuLi90eXBlcyc7XG5cbnR5cGUgUHJpb3JpdHkgPSBSZWFkaW5nTGlzdEVudHJ5Wydwcmlvcml0eSddO1xuXG5jb25zdCBzZXJpYWxpemVBcnJheSA9ICh2YWx1ZT86IHN0cmluZ1tdKSA9PiAodmFsdWUgPyBKU09OLnN0cmluZ2lmeSh2YWx1ZS5zbGljZSgwLCAyMCkpIDogbnVsbCk7XG5jb25zdCBkZXNlcmlhbGl6ZUFycmF5ID0gKHZhbHVlOiBzdHJpbmcgfCBudWxsKSA9PiAodmFsdWUgPyAoSlNPTi5wYXJzZSh2YWx1ZSkgYXMgc3RyaW5nW10pIDogdW5kZWZpbmVkKTtcblxuZXhwb3J0IGNvbnN0IGFkZEJvb2sgPSAoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBlbnRyeTogUmVhZGluZ0xpc3RFbnRyeSxcbik6IHsgYWRkZWQ6IGJvb2xlYW47IHJlYXNvbj86IHN0cmluZzsgaXRlbT86IFJlYWRpbmdMaXN0RW50cnkgfSA9PiB7XG4gIGNvbnN0IHNhZmVVc2VyID0gZW5zdXJlVXNlcih1c2VySWQpO1xuXG4gIHRyeSB7XG4gICAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoXG4gICAgICBgSU5TRVJUIElOVE8gcmVhZGluZ19saXN0ICh1c2VyX2lkLCBib29rX2lkLCBwcmlvcml0eSwgbm90ZXMsIGFkZGVkX2F0LCBzdGF0dXMsIHRpdGxlLCBhdXRob3JzLCB0aHVtYm5haWwpXG4gICAgICAgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KWAsXG4gICAgKTtcbiAgICBzdG10LnJ1bihcbiAgICAgIHNhZmVVc2VyLFxuICAgICAgZW50cnkuYm9va0lkLFxuICAgICAgZW50cnkucHJpb3JpdHksXG4gICAgICBlbnRyeS5ub3RlcyxcbiAgICAgIGVudHJ5LmFkZGVkQXQsXG4gICAgICBlbnRyeS5zdGF0dXMsXG4gICAgICBlbnRyeS50aXRsZSA/PyBudWxsLFxuICAgICAgZW50cnkuYXV0aG9ycyA/IEpTT04uc3RyaW5naWZ5KGVudHJ5LmF1dGhvcnMpIDogbnVsbCxcbiAgICAgIGVudHJ5LnRodW1ibmFpbCA/PyBudWxsLFxuICAgICk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBpZiAoZXJyb3I/LmNvZGUgPT09ICdTUUxJVEVfQ09OU1RSQUlOVF9VTklRVUUnKSB7XG4gICAgICByZXR1cm4geyBhZGRlZDogZmFsc2UsIHJlYXNvbjogJ0VsIGxpYnJvIHlhIGV4aXN0ZSBlbiB0dSBsaXN0YS4nIH0gYXMgY29uc3Q7XG4gICAgfVxuICAgIHRocm93IGVycm9yO1xuICB9XG5cbiAgcmV0dXJuIHsgYWRkZWQ6IHRydWUsIGl0ZW06IGVudHJ5IH0gYXMgY29uc3Q7XG59O1xuXG5leHBvcnQgY29uc3QgbGlzdEJvb2tzID0gKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgZmlsdGVyPzogUHJpb3JpdHksXG4gIGxpbWl0PzogbnVtYmVyLFxuKTogUmVhZGluZ0xpc3RFbnRyeVtdID0+IHtcbiAgY29uc3Qgc2FmZVVzZXIgPSBlbnN1cmVVc2VyKHVzZXJJZCk7XG4gIGNvbnN0IGZpbHRlcnM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IHBhcmFtczogKHN0cmluZyB8IG51bWJlcilbXSA9IFtzYWZlVXNlcl07XG5cbiAgaWYgKGZpbHRlciAmJiBmaWx0ZXIgIT09ICdhbGwnKSB7XG4gICAgZmlsdGVycy5wdXNoKCdwcmlvcml0eSA9ID8nKTtcbiAgICBwYXJhbXMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgY29uc3Qgd2hlcmUgPSBmaWx0ZXJzLmxlbmd0aCA/IGBBTkQgJHtmaWx0ZXJzLmpvaW4oJyBBTkQgJyl9YCA6ICcnO1xuICBjb25zdCBsaW1pdENsYXVzZSA9IGxpbWl0ID8gYExJTUlUICR7bGltaXR9YCA6ICcnO1xuXG4gIGNvbnN0IHJvd3MgPSBkYlxuICAgIC5wcmVwYXJlKFxuICAgICAgYFNFTEVDVCBpZCwgYm9va19pZCwgcHJpb3JpdHksIG5vdGVzLCBhZGRlZF9hdCwgc3RhdHVzLCByYXRpbmcsIHJldmlldywgZGF0ZV9maW5pc2hlZCwgdGl0bGUsIGF1dGhvcnMsIHRodW1ibmFpbFxuICAgICAgIEZST00gcmVhZGluZ19saXN0XG4gICAgICAgV0hFUkUgdXNlcl9pZCA9ID8gJHt3aGVyZX1cbiAgICAgICBPUkRFUiBCWSBhZGRlZF9hdCBERVNDICR7bGltaXRDbGF1c2V9YCxcbiAgICApXG4gICAgLmFsbCguLi5wYXJhbXMpO1xuXG4gIHJldHVybiByb3dzLm1hcCgocm93KSA9PiAoe1xuICAgIGlkOiByb3cuaWQsXG4gICAgYm9va0lkOiByb3cuYm9va19pZCxcbiAgICBwcmlvcml0eTogcm93LnByaW9yaXR5LFxuICAgIG5vdGVzOiByb3cubm90ZXMgPz8gdW5kZWZpbmVkLFxuICAgIGFkZGVkQXQ6IHJvdy5hZGRlZF9hdCxcbiAgICBzdGF0dXM6IHJvdy5zdGF0dXMsXG4gICAgcmF0aW5nOiByb3cucmF0aW5nID8/IHVuZGVmaW5lZCxcbiAgICByZXZpZXc6IHJvdy5yZXZpZXcgPz8gdW5kZWZpbmVkLFxuICAgIGRhdGVGaW5pc2hlZDogcm93LmRhdGVfZmluaXNoZWQgPz8gdW5kZWZpbmVkLFxuICAgIHRpdGxlOiByb3cudGl0bGUgPz8gdW5kZWZpbmVkLFxuICAgIGF1dGhvcnM6IGRlc2VyaWFsaXplQXJyYXkocm93LmF1dGhvcnMgPz8gbnVsbCksXG4gICAgdGh1bWJuYWlsOiByb3cudGh1bWJuYWlsID8/IHVuZGVmaW5lZCxcbiAgfSkpO1xufTtcblxuZXhwb3J0IGNvbnN0IG1hcmtCb29rQXNSZWFkID0gKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgYm9va0lkOiBzdHJpbmcsXG4gIHJhdGluZz86IG51bWJlcixcbiAgcmV2aWV3Pzogc3RyaW5nLFxuICBkYXRlRmluaXNoZWQ/OiBzdHJpbmcsXG4gIGRldGFpbHM/OiBCb29rRGV0YWlscyxcbikgPT4ge1xuICBjb25zdCBzYWZlVXNlciA9IGVuc3VyZVVzZXIodXNlcklkKTtcbiAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigoKSA9PiB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBkYlxuICAgICAgLnByZXBhcmUoJ1NFTEVDVCBpZCwgdGl0bGUsIGF1dGhvcnMsIHRodW1ibmFpbCBGUk9NIHJlYWRpbmdfbGlzdCBXSEVSRSB1c2VyX2lkID0gPyBBTkQgYm9va19pZCA9ID8nKVxuICAgICAgLmdldChzYWZlVXNlciwgYm9va0lkKTtcblxuICAgIGlmICghZXhpc3RpbmcpIHJldHVybiBmYWxzZTtcblxuICAgIGRiLnByZXBhcmUoXG4gICAgICBgVVBEQVRFIHJlYWRpbmdfbGlzdFxuICAgICAgIFNFVCBzdGF0dXMgPSAncmVhZCcsIHJhdGluZyA9ID8sIHJldmlldyA9ID8sIGRhdGVfZmluaXNoZWQgPSA/XG4gICAgICAgV0hFUkUgdXNlcl9pZCA9ID8gQU5EIGJvb2tfaWQgPSA/YCxcbiAgICApLnJ1bihyYXRpbmcgPz8gbnVsbCwgcmV2aWV3ID8/IG51bGwsIGRhdGVGaW5pc2hlZCA/PyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksIHNhZmVVc2VyLCBib29rSWQpO1xuXG4gICAgY29uc3QgdGFyZ2V0RGV0YWlscyA9IGRldGFpbHMgPz8gbnVsbDtcbiAgICBkYi5wcmVwYXJlKFxuICAgICAgYElOU0VSVCBPUiBSRVBMQUNFIElOVE8gcmVhZF9ib29rcyAodXNlcl9pZCwgYm9va19pZCwgcmF0aW5nLCByZXZpZXcsIGRhdGVfZmluaXNoZWQsIHBhZ2VfY291bnQsIGF1dGhvcnMsIGNhdGVnb3JpZXMsIHRpdGxlLCB0aHVtYm5haWwpXG4gICAgICAgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KWAsXG4gICAgKS5ydW4oXG4gICAgICBzYWZlVXNlcixcbiAgICAgIGJvb2tJZCxcbiAgICAgIHJhdGluZyA/PyBudWxsLFxuICAgICAgcmV2aWV3ID8/IG51bGwsXG4gICAgICBkYXRlRmluaXNoZWQgPz8gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgdGFyZ2V0RGV0YWlscz8ucGFnZUNvdW50ID8/IG51bGwsXG4gICAgICBzZXJpYWxpemVBcnJheSh0YXJnZXREZXRhaWxzPy5hdXRob3JzKSxcbiAgICAgIHNlcmlhbGl6ZUFycmF5KHRhcmdldERldGFpbHM/LmNhdGVnb3JpZXMpLFxuICAgICAgdGFyZ2V0RGV0YWlscz8udGl0bGUgPz8gZXhpc3Rpbmc/LnRpdGxlID8/IG51bGwsXG4gICAgICB0YXJnZXREZXRhaWxzPy50aHVtYm5haWwgPz8gZXhpc3Rpbmc/LnRodW1ibmFpbCA/PyBudWxsLFxuICAgICk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG5cbiAgcmV0dXJuIHR4KCk7XG59O1xuXG50eXBlIFBlcmlvZCA9ICdhbGwtdGltZScgfCAneWVhcicgfCAnbW9udGgnIHwgJ3dlZWsnO1xuXG5jb25zdCBpc1dpdGhpblBlcmlvZCA9IChkYXRlOiBzdHJpbmcgfCBudWxsLCBwZXJpb2Q6IFBlcmlvZCkgPT4ge1xuICBpZiAocGVyaW9kID09PSAnYWxsLXRpbWUnKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKCFkYXRlKSByZXR1cm4gZmFsc2U7XG4gIGNvbnN0IGN1cnJlbnQgPSBuZXcgRGF0ZSgpO1xuICBjb25zdCB0YXJnZXQgPSBuZXcgRGF0ZShkYXRlKTtcbiAgaWYgKE51bWJlci5pc05hTih0YXJnZXQuZ2V0VGltZSgpKSkgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChwZXJpb2QgPT09ICd5ZWFyJykgcmV0dXJuIHRhcmdldC5nZXRGdWxsWWVhcigpID09PSBjdXJyZW50LmdldEZ1bGxZZWFyKCk7XG4gIGlmIChwZXJpb2QgPT09ICdtb250aCcpXG4gICAgcmV0dXJuIHRhcmdldC5nZXRGdWxsWWVhcigpID09PSBjdXJyZW50LmdldEZ1bGxZZWFyKCkgJiYgdGFyZ2V0LmdldE1vbnRoKCkgPT09IGN1cnJlbnQuZ2V0TW9udGgoKTtcblxuICBjb25zdCBkaWZmID0gKGN1cnJlbnQuZ2V0VGltZSgpIC0gdGFyZ2V0LmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XG4gIHJldHVybiBkaWZmIDw9IDc7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0U3RhdHMgPSAodXNlcklkOiBzdHJpbmcsIHBlcmlvZDogUGVyaW9kID0gJ2FsbC10aW1lJyk6IFJlYWRpbmdTdGF0cyA9PiB7XG4gIGNvbnN0IHNhZmVVc2VyID0gZW5zdXJlVXNlcih1c2VySWQpO1xuICBjb25zdCByZWFkUm93cyA9IGRiXG4gICAgLnByZXBhcmUoXG4gICAgICBgU0VMRUNUIGJvb2tfaWQsIHJhdGluZywgcmV2aWV3LCBkYXRlX2ZpbmlzaGVkLCBwYWdlX2NvdW50LCBhdXRob3JzLCBjYXRlZ29yaWVzLCB0aXRsZSwgdGh1bWJuYWlsXG4gICAgICAgRlJPTSByZWFkX2Jvb2tzIFdIRVJFIHVzZXJfaWQgPSA/IE9SREVSIEJZIGRhdGVfZmluaXNoZWQgREVTQ2AsXG4gICAgKVxuICAgIC5hbGwoc2FmZVVzZXIpXG4gICAgLmZpbHRlcigocm93KSA9PiBpc1dpdGhpblBlcmlvZChyb3cuZGF0ZV9maW5pc2hlZCA/PyBudWxsLCBwZXJpb2QpKTtcblxuICBjb25zdCB0b3RhbFJlYWQgPSByZWFkUm93cy5sZW5ndGg7XG4gIGNvbnN0IHRvdGFsUGFnZXMgPSByZWFkUm93cy5yZWR1Y2UoKHN1bSwgcm93KSA9PiBzdW0gKyAocm93LnBhZ2VfY291bnQgfHwgMCksIDApO1xuICBjb25zdCByYXRlZCA9IHJlYWRSb3dzLmZpbHRlcigocm93KSA9PiByb3cucmF0aW5nICE9IG51bGwpO1xuICBjb25zdCBhdmVyYWdlUmF0aW5nID0gcmF0ZWQubGVuZ3RoXG4gICAgPyByYXRlZC5yZWR1Y2UoKHN1bSwgcm93KSA9PiBzdW0gKyBOdW1iZXIocm93LnJhdGluZyksIDApIC8gcmF0ZWQubGVuZ3RoXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgY29uc3QgZ2VucmVzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gIGNvbnN0IGF1dGhvcnM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgY29uc3QgYnlQZXJpb2Q6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICBjb25zdCB0b0tleSA9IChkYXRlPzogc3RyaW5nKSA9PiB7XG4gICAgaWYgKCFkYXRlKSByZXR1cm4gJ3Vua25vd24nO1xuICAgIGNvbnN0IHBhcnNlZCA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIGlmIChOdW1iZXIuaXNOYU4ocGFyc2VkLmdldFRpbWUoKSkpIHJldHVybiAndW5rbm93bic7XG4gICAgcmV0dXJuIHBhcnNlZC50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcbiAgfTtcblxuICByZWFkUm93cy5mb3JFYWNoKChyb3cpID0+IHtcbiAgICBjb25zdCBkYXlLZXkgPSB0b0tleShyb3cuZGF0ZV9maW5pc2hlZCk7XG4gICAgYnlQZXJpb2RbZGF5S2V5XSA9IChieVBlcmlvZFtkYXlLZXldIHx8IDApICsgMTtcblxuICAgIGNvbnN0IHJvd0dlbnJlcyA9IGRlc2VyaWFsaXplQXJyYXkocm93LmNhdGVnb3JpZXMgPz8gbnVsbCkgPz8gW107XG4gICAgcm93R2VucmVzLmZvckVhY2goKGdlbnJlKSA9PiB7XG4gICAgICBnZW5yZXNbZ2VucmVdID0gKGdlbnJlc1tnZW5yZV0gfHwgMCkgKyAxO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgcm93QXV0aG9ycyA9IGRlc2VyaWFsaXplQXJyYXkocm93LmF1dGhvcnMgPz8gbnVsbCkgPz8gW107XG4gICAgcm93QXV0aG9ycy5mb3JFYWNoKChhdXRob3IpID0+IHtcbiAgICAgIGF1dGhvcnNbYXV0aG9yXSA9IChhdXRob3JzW2F1dGhvcl0gfHwgMCkgKyAxO1xuICAgIH0pO1xuICB9KTtcblxuICBjb25zdCBzb3J0ZWREYXRlcyA9IE9iamVjdC5rZXlzKGJ5UGVyaW9kKVxuICAgIC5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSAndW5rbm93bicpXG4gICAgLnNvcnQoKGEsIGIpID0+IChhID4gYiA/IC0xIDogMSkpO1xuXG4gIGxldCBzdHJlYWtEYXlzID0gMDtcbiAgbGV0IHByZXZpb3VzOiBEYXRlIHwgbnVsbCA9IG51bGw7XG4gIGZvciAoY29uc3Qga2V5IG9mIHNvcnRlZERhdGVzKSB7XG4gICAgY29uc3QgY3VycmVudCA9IG5ldyBEYXRlKGtleSk7XG4gICAgaWYgKCFwcmV2aW91cykge1xuICAgICAgc3RyZWFrRGF5cyA9IDE7XG4gICAgICBwcmV2aW91cyA9IGN1cnJlbnQ7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgZGlmZiA9IChwcmV2aW91cy5nZXRUaW1lKCkgLSBjdXJyZW50LmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XG4gICAgaWYgKGRpZmYgPT09IDEpIHtcbiAgICAgIHN0cmVha0RheXMgKz0gMTtcbiAgICB9IGVsc2UgaWYgKGRpZmYgPiAxKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgcHJldmlvdXMgPSBjdXJyZW50O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0b3RhbFJlYWQsXG4gICAgdG90YWxQYWdlcyxcbiAgICBhdmVyYWdlUmF0aW5nLFxuICAgIGdlbnJlcyxcbiAgICBhdXRob3JzLFxuICAgIGJ5UGVyaW9kLFxuICAgIHN0cmVha0RheXMsXG4gIH07XG59O1xuIl0sIm5hbWVzIjpbImRiIiwiZW5zdXJlVXNlciIsInNlcmlhbGl6ZUFycmF5IiwidmFsdWUiLCJKU09OIiwic3RyaW5naWZ5Iiwic2xpY2UiLCJkZXNlcmlhbGl6ZUFycmF5IiwicGFyc2UiLCJ1bmRlZmluZWQiLCJhZGRCb29rIiwidXNlcklkIiwiZW50cnkiLCJzYWZlVXNlciIsInN0bXQiLCJwcmVwYXJlIiwicnVuIiwiYm9va0lkIiwicHJpb3JpdHkiLCJub3RlcyIsImFkZGVkQXQiLCJzdGF0dXMiLCJ0aXRsZSIsImF1dGhvcnMiLCJ0aHVtYm5haWwiLCJlcnJvciIsImNvZGUiLCJhZGRlZCIsInJlYXNvbiIsIml0ZW0iLCJsaXN0Qm9va3MiLCJmaWx0ZXIiLCJsaW1pdCIsImZpbHRlcnMiLCJwYXJhbXMiLCJwdXNoIiwid2hlcmUiLCJsZW5ndGgiLCJqb2luIiwibGltaXRDbGF1c2UiLCJyb3dzIiwiYWxsIiwibWFwIiwicm93IiwiaWQiLCJib29rX2lkIiwiYWRkZWRfYXQiLCJyYXRpbmciLCJyZXZpZXciLCJkYXRlRmluaXNoZWQiLCJkYXRlX2ZpbmlzaGVkIiwibWFya0Jvb2tBc1JlYWQiLCJkZXRhaWxzIiwidHgiLCJ0cmFuc2FjdGlvbiIsImV4aXN0aW5nIiwiZ2V0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidGFyZ2V0RGV0YWlscyIsInBhZ2VDb3VudCIsImNhdGVnb3JpZXMiLCJpc1dpdGhpblBlcmlvZCIsImRhdGUiLCJwZXJpb2QiLCJjdXJyZW50IiwidGFyZ2V0IiwiTnVtYmVyIiwiaXNOYU4iLCJnZXRUaW1lIiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImRpZmYiLCJnZXRTdGF0cyIsInJlYWRSb3dzIiwidG90YWxSZWFkIiwidG90YWxQYWdlcyIsInJlZHVjZSIsInN1bSIsInBhZ2VfY291bnQiLCJyYXRlZCIsImF2ZXJhZ2VSYXRpbmciLCJnZW5yZXMiLCJieVBlcmlvZCIsInRvS2V5IiwicGFyc2VkIiwiZm9yRWFjaCIsImRheUtleSIsInJvd0dlbnJlcyIsImdlbnJlIiwicm93QXV0aG9ycyIsImF1dGhvciIsInNvcnRlZERhdGVzIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsInNvcnQiLCJhIiwiYiIsInN0cmVha0RheXMiLCJwcmV2aW91cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/datastore.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/db.ts":
/*!**************************!*\
  !*** ./src/server/db.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   ensureUser: () => (/* binding */ ensureUser)\n/* harmony export */ });\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-sqlite3 */ \"better-sqlite3\");\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(better_sqlite3__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:path */ \"node:path\");\n/* harmony import */ var node_path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_path__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst resolveDatabasePath = ()=>{\n    const url = process.env.DATABASE_URL ?? 'file:./data/bookadvisor.sqlite';\n    if (url.startsWith('file:')) {\n        const target = url.replace('file:', '');\n        return node_path__WEBPACK_IMPORTED_MODULE_2___default().isAbsolute(target) ? target : node_path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), target);\n    }\n    if (url.startsWith('sqlite:')) {\n        const target = url.replace('sqlite:', '');\n        return node_path__WEBPACK_IMPORTED_MODULE_2___default().isAbsolute(target) ? target : node_path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), target);\n    }\n    // Fallback to local file to keep the prototype self contained.\n    return node_path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), 'data', 'bookadvisor.sqlite');\n};\nconst dbPath = resolveDatabasePath();\nnode_fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(node_path__WEBPACK_IMPORTED_MODULE_2___default().dirname(dbPath), {\n    recursive: true\n});\nconst db = new (better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default())(dbPath);\ndb.pragma('journal_mode = WAL');\ndb.pragma('foreign_keys = ON');\ndb.exec(`\n  CREATE TABLE IF NOT EXISTS users (\n    id TEXT PRIMARY KEY,\n    created_at TEXT DEFAULT CURRENT_TIMESTAMP\n  );\n\n  CREATE TABLE IF NOT EXISTS reading_list (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    user_id TEXT NOT NULL,\n    book_id TEXT NOT NULL,\n    priority TEXT NOT NULL,\n    notes TEXT,\n    added_at TEXT NOT NULL,\n    status TEXT NOT NULL DEFAULT 'pending',\n    rating INTEGER,\n    review TEXT,\n    date_finished TEXT,\n    title TEXT,\n    authors TEXT,\n    thumbnail TEXT,\n    UNIQUE (user_id, book_id),\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n  );\n\n  CREATE TABLE IF NOT EXISTS read_books (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    user_id TEXT NOT NULL,\n    book_id TEXT NOT NULL,\n    rating INTEGER,\n    review TEXT,\n    date_finished TEXT,\n    page_count INTEGER,\n    authors TEXT,\n    categories TEXT,\n    title TEXT,\n    thumbnail TEXT,\n    created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n    UNIQUE (user_id, book_id)\n  );\n\n  CREATE INDEX IF NOT EXISTS idx_read_books_user_id ON read_books(user_id);\n  CREATE INDEX IF NOT EXISTS idx_reading_list_user_id ON reading_list(user_id);\n`);\nconst ensureUser = (userId)=>{\n    const safeId = userId.replace(/[^a-zA-Z0-9-_]/g, '').slice(0, 64) || 'guest';\n    db.prepare('INSERT OR IGNORE INTO users (id) VALUES (?)').run(safeId);\n    return safeId;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNDO0FBQ2I7QUFDSTtBQUU3QixNQUFNRyxzQkFBc0I7SUFDMUIsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7SUFFeEMsSUFBSUgsSUFBSUksVUFBVSxDQUFDLFVBQVU7UUFDM0IsTUFBTUMsU0FBU0wsSUFBSU0sT0FBTyxDQUFDLFNBQVM7UUFDcEMsT0FBT1IsMkRBQWUsQ0FBQ08sVUFBVUEsU0FBU1AscURBQVMsQ0FBQ0csUUFBUVEsR0FBRyxJQUFJSjtJQUNyRTtJQUVBLElBQUlMLElBQUlJLFVBQVUsQ0FBQyxZQUFZO1FBQzdCLE1BQU1DLFNBQVNMLElBQUlNLE9BQU8sQ0FBQyxXQUFXO1FBQ3RDLE9BQU9SLDJEQUFlLENBQUNPLFVBQVVBLFNBQVNQLHFEQUFTLENBQUNHLFFBQVFRLEdBQUcsSUFBSUo7SUFDckU7SUFFQSwrREFBK0Q7SUFDL0QsT0FBT1AscURBQVMsQ0FBQ0csUUFBUVEsR0FBRyxJQUFJLFFBQVE7QUFDMUM7QUFFQSxNQUFNQyxTQUFTWDtBQUNmRix3REFBWSxDQUFDQyx3REFBWSxDQUFDWSxTQUFTO0lBQUVHLFdBQVc7QUFBSztBQUU5QyxNQUFNQyxLQUFLLElBQUlsQix1REFBUUEsQ0FBQ2MsUUFBUTtBQUV2Q0ksR0FBR0MsTUFBTSxDQUFDO0FBQ1ZELEdBQUdDLE1BQU0sQ0FBQztBQUVWRCxHQUFHRSxJQUFJLENBQUMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTJDVCxDQUFDO0FBRU0sTUFBTUMsYUFBYSxDQUFDQztJQUN6QixNQUFNQyxTQUFTRCxPQUFPWixPQUFPLENBQUMsbUJBQW1CLElBQUljLEtBQUssQ0FBQyxHQUFHLE9BQU87SUFDckVOLEdBQUdPLE9BQU8sQ0FBQywrQ0FBK0NDLEdBQUcsQ0FBQ0g7SUFDOUQsT0FBT0E7QUFDVCxFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWktYm9vay1hZHZpc29yLy4vc3JjL3NlcnZlci9kYi50cz9hYTZmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBEYXRhYmFzZSBmcm9tICdiZXR0ZXItc3FsaXRlMyc7XG5pbXBvcnQgZnMgZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdub2RlOnBhdGgnO1xuXG5jb25zdCByZXNvbHZlRGF0YWJhc2VQYXRoID0gKCkgPT4ge1xuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPz8gJ2ZpbGU6Li9kYXRhL2Jvb2thZHZpc29yLnNxbGl0ZSc7XG5cbiAgaWYgKHVybC5zdGFydHNXaXRoKCdmaWxlOicpKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gdXJsLnJlcGxhY2UoJ2ZpbGU6JywgJycpO1xuICAgIHJldHVybiBwYXRoLmlzQWJzb2x1dGUodGFyZ2V0KSA/IHRhcmdldCA6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0YXJnZXQpO1xuICB9XG5cbiAgaWYgKHVybC5zdGFydHNXaXRoKCdzcWxpdGU6JykpIHtcbiAgICBjb25zdCB0YXJnZXQgPSB1cmwucmVwbGFjZSgnc3FsaXRlOicsICcnKTtcbiAgICByZXR1cm4gcGF0aC5pc0Fic29sdXRlKHRhcmdldCkgPyB0YXJnZXQgOiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGFyZ2V0KTtcbiAgfVxuXG4gIC8vIEZhbGxiYWNrIHRvIGxvY2FsIGZpbGUgdG8ga2VlcCB0aGUgcHJvdG90eXBlIHNlbGYgY29udGFpbmVkLlxuICByZXR1cm4gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhJywgJ2Jvb2thZHZpc29yLnNxbGl0ZScpO1xufTtcblxuY29uc3QgZGJQYXRoID0gcmVzb2x2ZURhdGFiYXNlUGF0aCgpO1xuZnMubWtkaXJTeW5jKHBhdGguZGlybmFtZShkYlBhdGgpLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcblxuZXhwb3J0IGNvbnN0IGRiID0gbmV3IERhdGFiYXNlKGRiUGF0aCk7XG5cbmRiLnByYWdtYSgnam91cm5hbF9tb2RlID0gV0FMJyk7XG5kYi5wcmFnbWEoJ2ZvcmVpZ25fa2V5cyA9IE9OJyk7XG5cbmRiLmV4ZWMoYFxuICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB1c2VycyAoXG4gICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICBjcmVhdGVkX2F0IFRFWFQgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICApO1xuXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHJlYWRpbmdfbGlzdCAoXG4gICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgIHVzZXJfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICBib29rX2lkIFRFWFQgTk9UIE5VTEwsXG4gICAgcHJpb3JpdHkgVEVYVCBOT1QgTlVMTCxcbiAgICBub3RlcyBURVhULFxuICAgIGFkZGVkX2F0IFRFWFQgTk9UIE5VTEwsXG4gICAgc3RhdHVzIFRFWFQgTk9UIE5VTEwgREVGQVVMVCAncGVuZGluZycsXG4gICAgcmF0aW5nIElOVEVHRVIsXG4gICAgcmV2aWV3IFRFWFQsXG4gICAgZGF0ZV9maW5pc2hlZCBURVhULFxuICAgIHRpdGxlIFRFWFQsXG4gICAgYXV0aG9ycyBURVhULFxuICAgIHRodW1ibmFpbCBURVhULFxuICAgIFVOSVFVRSAodXNlcl9pZCwgYm9va19pZCksXG4gICAgRk9SRUlHTiBLRVkgKHVzZXJfaWQpIFJFRkVSRU5DRVMgdXNlcnMoaWQpIE9OIERFTEVURSBDQVNDQURFXG4gICk7XG5cbiAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcmVhZF9ib29rcyAoXG4gICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgIHVzZXJfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICBib29rX2lkIFRFWFQgTk9UIE5VTEwsXG4gICAgcmF0aW5nIElOVEVHRVIsXG4gICAgcmV2aWV3IFRFWFQsXG4gICAgZGF0ZV9maW5pc2hlZCBURVhULFxuICAgIHBhZ2VfY291bnQgSU5URUdFUixcbiAgICBhdXRob3JzIFRFWFQsXG4gICAgY2F0ZWdvcmllcyBURVhULFxuICAgIHRpdGxlIFRFWFQsXG4gICAgdGh1bWJuYWlsIFRFWFQsXG4gICAgY3JlYXRlZF9hdCBURVhUIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAsXG4gICAgRk9SRUlHTiBLRVkgKHVzZXJfaWQpIFJFRkVSRU5DRVMgdXNlcnMoaWQpIE9OIERFTEVURSBDQVNDQURFLFxuICAgIFVOSVFVRSAodXNlcl9pZCwgYm9va19pZClcbiAgKTtcblxuICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfcmVhZF9ib29rc191c2VyX2lkIE9OIHJlYWRfYm9va3ModXNlcl9pZCk7XG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9yZWFkaW5nX2xpc3RfdXNlcl9pZCBPTiByZWFkaW5nX2xpc3QodXNlcl9pZCk7XG5gKTtcblxuZXhwb3J0IGNvbnN0IGVuc3VyZVVzZXIgPSAodXNlcklkOiBzdHJpbmcpID0+IHtcbiAgY29uc3Qgc2FmZUlkID0gdXNlcklkLnJlcGxhY2UoL1teYS16QS1aMC05LV9dL2csICcnKS5zbGljZSgwLCA2NCkgfHwgJ2d1ZXN0JztcbiAgZGIucHJlcGFyZSgnSU5TRVJUIE9SIElHTk9SRSBJTlRPIHVzZXJzIChpZCkgVkFMVUVTICg/KScpLnJ1bihzYWZlSWQpO1xuICByZXR1cm4gc2FmZUlkO1xufTtcbiJdLCJuYW1lcyI6WyJEYXRhYmFzZSIsImZzIiwicGF0aCIsInJlc29sdmVEYXRhYmFzZVBhdGgiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiREFUQUJBU0VfVVJMIiwic3RhcnRzV2l0aCIsInRhcmdldCIsInJlcGxhY2UiLCJpc0Fic29sdXRlIiwiam9pbiIsImN3ZCIsImRiUGF0aCIsIm1rZGlyU3luYyIsImRpcm5hbWUiLCJyZWN1cnNpdmUiLCJkYiIsInByYWdtYSIsImV4ZWMiLCJlbnN1cmVVc2VyIiwidXNlcklkIiwic2FmZUlkIiwic2xpY2UiLCJwcmVwYXJlIiwicnVuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/server/db.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/googleBooks.ts":
/*!***********************************!*\
  !*** ./src/server/googleBooks.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchBookDetails: () => (/* binding */ fetchBookDetails),\n/* harmony export */   searchBooks: () => (/* binding */ searchBooks)\n/* harmony export */ });\n/* harmony import */ var _validation__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validation */ \"(rsc)/./src/server/validation.ts\");\n\nconst GOOGLE_BOOKS_BASE = 'https://www.googleapis.com/books/v1';\nconst pickISBN = (identifiers)=>{\n    if (!identifiers) return {};\n    const isbn10 = identifiers.find((id)=>id.type === 'ISBN_10')?.identifier;\n    const isbn13 = identifiers.find((id)=>id.type === 'ISBN_13')?.identifier;\n    return {\n        isbn10,\n        isbn13\n    };\n};\nconst searchBooks = async (query, maxResults, orderBy, apiKey)=>{\n    const safeQuery = (0,_validation__WEBPACK_IMPORTED_MODULE_0__.sanitizeQuery)(query);\n    const params = new URLSearchParams({\n        q: safeQuery,\n        maxResults: String(maxResults),\n        orderBy\n    });\n    if (apiKey) params.set('key', apiKey);\n    const res = await fetch(`${GOOGLE_BOOKS_BASE}/volumes?${params.toString()}`, {\n        headers: {\n            'User-Agent': 'ai-book-advisor/1.0'\n        }\n    });\n    if (!res.ok) {\n        throw new Error(`Google Books respondió ${res.status}`);\n    }\n    const payload = await res.json();\n    const items = payload.items ?? [];\n    return items.map((item)=>({\n            id: item.id,\n            title: item.volumeInfo?.title ?? 'Título no disponible',\n            authors: item.volumeInfo?.authors ?? [],\n            thumbnail: item.volumeInfo?.imageLinks?.thumbnail\n        }));\n};\nconst fetchBookDetails = async (bookId, apiKey)=>{\n    const params = new URLSearchParams();\n    if (apiKey) params.set('key', apiKey);\n    const res = await fetch(`${GOOGLE_BOOKS_BASE}/volumes/${encodeURIComponent(bookId)}?${params.toString()}`, {\n        headers: {\n            'User-Agent': 'ai-book-advisor/1.0'\n        }\n    });\n    if (!res.ok) {\n        throw new Error(`Google Books respondió ${res.status}`);\n    }\n    const payload = await res.json();\n    const info = payload.volumeInfo ?? {};\n    const identifiers = pickISBN(info.industryIdentifiers);\n    return {\n        id: payload.id,\n        title: info.title ?? 'Título no disponible',\n        authors: info.authors ?? [],\n        thumbnail: info.imageLinks?.thumbnail,\n        description: info.description,\n        pageCount: info.pageCount,\n        categories: info.categories,\n        averageRating: info.averageRating,\n        ratingsCount: info.ratingsCount,\n        publishedDate: info.publishedDate,\n        publisher: info.publisher,\n        language: info.language,\n        infoLink: info.infoLink,\n        ...identifiers\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNoQjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1ib29rLWFkdmlzb3IvLi9zcmMvc2VydmVyL2dvb2dsZUJvb2tzLnRzPzlhNTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzaWNCb29rLCBCb29rRGV0YWlscyB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IHNhbml0aXplUXVlcnkgfSBmcm9tICcuL3ZhbGlkYXRpb24nO1xuXG5jb25zdCBHT09HTEVfQk9PS1NfQkFTRSA9ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9ib29rcy92MSc7XG5cbmNvbnN0IHBpY2tJU0JOID0gKGlkZW50aWZpZXJzPzogeyB0eXBlOiBzdHJpbmc7IGlkZW50aWZpZXI6IHN0cmluZyB9W10pID0+IHtcbiAgaWYgKCFpZGVudGlmaWVycykgcmV0dXJuIHt9O1xuICBjb25zdCBpc2JuMTAgPSBpZGVudGlmaWVycy5maW5kKChpZCkgPT4gaWQudHlwZSA9PT0gJ0lTQk5fMTAnKT8uaWRlbnRpZmllcjtcbiAgY29uc3QgaXNibjEzID0gaWRlbnRpZmllcnMuZmluZCgoaWQpID0+IGlkLnR5cGUgPT09ICdJU0JOXzEzJyk/LmlkZW50aWZpZXI7XG4gIHJldHVybiB7IGlzYm4xMCwgaXNibjEzIH07XG59O1xuXG5leHBvcnQgY29uc3Qgc2VhcmNoQm9va3MgPSBhc3luYyAoXG4gIHF1ZXJ5OiBzdHJpbmcsXG4gIG1heFJlc3VsdHM6IG51bWJlcixcbiAgb3JkZXJCeTogJ3JlbGV2YW5jZScgfCAnbmV3ZXN0JyxcbiAgYXBpS2V5Pzogc3RyaW5nLFxuKTogUHJvbWlzZTxCYXNpY0Jvb2tbXT4gPT4ge1xuICBjb25zdCBzYWZlUXVlcnkgPSBzYW5pdGl6ZVF1ZXJ5KHF1ZXJ5KTtcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7IHE6IHNhZmVRdWVyeSwgbWF4UmVzdWx0czogU3RyaW5nKG1heFJlc3VsdHMpLCBvcmRlckJ5IH0pO1xuICBpZiAoYXBpS2V5KSBwYXJhbXMuc2V0KCdrZXknLCBhcGlLZXkpO1xuXG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke0dPT0dMRV9CT09LU19CQVNFfS92b2x1bWVzPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCwge1xuICAgIGhlYWRlcnM6IHsgJ1VzZXItQWdlbnQnOiAnYWktYm9vay1hZHZpc29yLzEuMCcgfSxcbiAgfSk7XG4gIGlmICghcmVzLm9rKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBHb29nbGUgQm9va3MgcmVzcG9uZGnDsyAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBjb25zdCBwYXlsb2FkID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgY29uc3QgaXRlbXMgPSBwYXlsb2FkLml0ZW1zID8/IFtdO1xuICByZXR1cm4gaXRlbXMubWFwKChpdGVtOiBhbnkpID0+ICh7XG4gICAgaWQ6IGl0ZW0uaWQsXG4gICAgdGl0bGU6IGl0ZW0udm9sdW1lSW5mbz8udGl0bGUgPz8gJ1TDrXR1bG8gbm8gZGlzcG9uaWJsZScsXG4gICAgYXV0aG9yczogaXRlbS52b2x1bWVJbmZvPy5hdXRob3JzID8/IFtdLFxuICAgIHRodW1ibmFpbDogaXRlbS52b2x1bWVJbmZvPy5pbWFnZUxpbmtzPy50aHVtYm5haWwsXG4gIH0pKTtcbn07XG5cbmV4cG9ydCBjb25zdCBmZXRjaEJvb2tEZXRhaWxzID0gYXN5bmMgKGJvb2tJZDogc3RyaW5nLCBhcGlLZXk/OiBzdHJpbmcpOiBQcm9taXNlPEJvb2tEZXRhaWxzPiA9PiB7XG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcbiAgaWYgKGFwaUtleSkgcGFyYW1zLnNldCgna2V5JywgYXBpS2V5KTtcbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYCR7R09PR0xFX0JPT0tTX0JBU0V9L3ZvbHVtZXMvJHtlbmNvZGVVUklDb21wb25lbnQoYm9va0lkKX0/JHtwYXJhbXMudG9TdHJpbmcoKX1gLCB7XG4gICAgaGVhZGVyczogeyAnVXNlci1BZ2VudCc6ICdhaS1ib29rLWFkdmlzb3IvMS4wJyB9LFxuICB9KTtcbiAgaWYgKCFyZXMub2spIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEdvb2dsZSBCb29rcyByZXNwb25kacOzICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuICBjb25zdCBwYXlsb2FkID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgY29uc3QgaW5mbyA9IHBheWxvYWQudm9sdW1lSW5mbyA/PyB7fTtcbiAgY29uc3QgaWRlbnRpZmllcnMgPSBwaWNrSVNCTihpbmZvLmluZHVzdHJ5SWRlbnRpZmllcnMpO1xuICByZXR1cm4ge1xuICAgIGlkOiBwYXlsb2FkLmlkLFxuICAgIHRpdGxlOiBpbmZvLnRpdGxlID8/ICdUw610dWxvIG5vIGRpc3BvbmlibGUnLFxuICAgIGF1dGhvcnM6IGluZm8uYXV0aG9ycyA/PyBbXSxcbiAgICB0aHVtYm5haWw6IGluZm8uaW1hZ2VMaW5rcz8udGh1bWJuYWlsLFxuICAgIGRlc2NyaXB0aW9uOiBpbmZvLmRlc2NyaXB0aW9uLFxuICAgIHBhZ2VDb3VudDogaW5mby5wYWdlQ291bnQsXG4gICAgY2F0ZWdvcmllczogaW5mby5jYXRlZ29yaWVzLFxuICAgIGF2ZXJhZ2VSYXRpbmc6IGluZm8uYXZlcmFnZVJhdGluZyxcbiAgICByYXRpbmdzQ291bnQ6IGluZm8ucmF0aW5nc0NvdW50LFxuICAgIHB1Ymxpc2hlZERhdGU6IGluZm8ucHVibGlzaGVkRGF0ZSxcbiAgICBwdWJsaXNoZXI6IGluZm8ucHVibGlzaGVyLFxuICAgIGxhbmd1YWdlOiBpbmZvLmxhbmd1YWdlLFxuICAgIGluZm9MaW5rOiBpbmZvLmluZm9MaW5rLFxuICAgIC4uLmlkZW50aWZpZXJzLFxuICB9O1xufTtcbiJdLCJuYW1lcyI6WyJzYW5pdGl6ZVF1ZXJ5IiwiR09PR0xFX0JPT0tTX0JBU0UiLCJwaWNrSVNCTiIsImlkZW50aWZpZXJzIiwiaXNibjEwIiwiZmluZCIsImlkIiwidHlwZSIsImlkZW50aWZpZXIiLCJpc2JuMTMiLCJzZWFyY2hCb29rcyIsInF1ZXJ5IiwibWF4UmVzdWx0cyIsIm9yZGVyQnkiLCJhcGlLZXkiLCJzYWZlUXVlcnkiLCJwYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJxIiwiU3RyaW5nIiwic2V0IiwicmVzIiwiZmV0Y2giLCJ0b1N0cmluZyIsImhlYWRlcnMiLCJvayIsIkVycm9yIiwic3RhdHVzIiwicGF5bG9hZCIsImpzb24iLCJpdGVtcyIsIm1hcCIsIml0ZW0iLCJ0aXRsZSIsInZvbHVtZUluZm8iLCJhdXRob3JzIiwidGh1bWJuYWlsIiwiaW1hZ2VMaW5rcyIsImZldGNoQm9va0RldGFpbHMiLCJib29rSWQiLCJlbmNvZGVVUklDb21wb25lbnQiLCJpbmZvIiwiaW5kdXN0cnlJZGVudGlmaWVycyIsImRlc2NyaXB0aW9uIiwicGFnZUNvdW50IiwiY2F0ZWdvcmllcyIsImF2ZXJhZ2VSYXRpbmciLCJyYXRpbmdzQ291bnQiLCJwdWJsaXNoZWREYXRlIiwicHVibGlzaGVyIiwibGFuZ3VhZ2UiLCJpbmZvTGluayJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/googleBooks.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/rateLimit.ts":
/*!*********************************!*\
  !*** ./src/server/rateLimit.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   rateLimit: () => (/* binding */ rateLimit)\n/* harmony export */ });\nconst windows = {};\nconst now = ()=>Date.now();\nconst rateLimit = (identifier)=>{\n    const limit = Number(process.env.RATE_LIMIT_MAX_REQUESTS ?? 100);\n    const windowMs = Number(process.env.RATE_LIMIT_WINDOW_MS ?? 15 * 60 * 1000);\n    const key = identifier || 'anonymous';\n    const current = windows[key];\n    const nowTs = now();\n    if (!current || current.expiresAt < nowTs) {\n        windows[key] = {\n            count: 1,\n            expiresAt: nowTs + windowMs\n        };\n        return {\n            success: true,\n            remaining: limit - 1,\n            resetIn: windowMs\n        };\n    }\n    if (current.count >= limit) {\n        return {\n            success: false,\n            remaining: 0,\n            resetIn: current.expiresAt - nowTs\n        };\n    }\n    current.count += 1;\n    return {\n        success: true,\n        remaining: limit - current.count,\n        resetIn: current.expiresAt - nowTs\n    };\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3JhdGVMaW1pdC50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTUEsVUFBZ0UsQ0FBQztBQUV2RSxNQUFNQyxNQUFNLElBQU1DLEtBQUtELEdBQUc7QUFFbkIsTUFBTUUsWUFBWSxDQUFDQztJQUN4QixNQUFNQyxRQUFRQyxPQUFPQyxRQUFRQyxHQUFHLENBQUNDLHVCQUF1QixJQUFJO0lBQzVELE1BQU1DLFdBQVdKLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0csb0JBQW9CLElBQUksS0FBSyxLQUFLO0lBQ3RFLE1BQU1DLE1BQU1SLGNBQWM7SUFDMUIsTUFBTVMsVUFBVWIsT0FBTyxDQUFDWSxJQUFJO0lBQzVCLE1BQU1FLFFBQVFiO0lBRWQsSUFBSSxDQUFDWSxXQUFXQSxRQUFRRSxTQUFTLEdBQUdELE9BQU87UUFDekNkLE9BQU8sQ0FBQ1ksSUFBSSxHQUFHO1lBQUVJLE9BQU87WUFBR0QsV0FBV0QsUUFBUUo7UUFBUztRQUN2RCxPQUFPO1lBQUVPLFNBQVM7WUFBTUMsV0FBV2IsUUFBUTtZQUFHYyxTQUFTVDtRQUFTO0lBQ2xFO0lBRUEsSUFBSUcsUUFBUUcsS0FBSyxJQUFJWCxPQUFPO1FBQzFCLE9BQU87WUFBRVksU0FBUztZQUFPQyxXQUFXO1lBQUdDLFNBQVNOLFFBQVFFLFNBQVMsR0FBR0Q7UUFBTTtJQUM1RTtJQUVBRCxRQUFRRyxLQUFLLElBQUk7SUFDakIsT0FBTztRQUFFQyxTQUFTO1FBQU1DLFdBQVdiLFFBQVFRLFFBQVFHLEtBQUs7UUFBRUcsU0FBU04sUUFBUUUsU0FBUyxHQUFHRDtJQUFNO0FBQy9GLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haS1ib29rLWFkdmlzb3IvLi9zcmMvc2VydmVyL3JhdGVMaW1pdC50cz9hMjdlIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHdpbmRvd3M6IFJlY29yZDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgZXhwaXJlc0F0OiBudW1iZXIgfT4gPSB7fTtcblxuY29uc3Qgbm93ID0gKCkgPT4gRGF0ZS5ub3coKTtcblxuZXhwb3J0IGNvbnN0IHJhdGVMaW1pdCA9IChpZGVudGlmaWVyOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbGltaXQgPSBOdW1iZXIocHJvY2Vzcy5lbnYuUkFURV9MSU1JVF9NQVhfUkVRVUVTVFMgPz8gMTAwKTtcbiAgY29uc3Qgd2luZG93TXMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuUkFURV9MSU1JVF9XSU5ET1dfTVMgPz8gMTUgKiA2MCAqIDEwMDApO1xuICBjb25zdCBrZXkgPSBpZGVudGlmaWVyIHx8ICdhbm9ueW1vdXMnO1xuICBjb25zdCBjdXJyZW50ID0gd2luZG93c1trZXldO1xuICBjb25zdCBub3dUcyA9IG5vdygpO1xuXG4gIGlmICghY3VycmVudCB8fCBjdXJyZW50LmV4cGlyZXNBdCA8IG5vd1RzKSB7XG4gICAgd2luZG93c1trZXldID0geyBjb3VudDogMSwgZXhwaXJlc0F0OiBub3dUcyArIHdpbmRvd01zIH07XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVtYWluaW5nOiBsaW1pdCAtIDEsIHJlc2V0SW46IHdpbmRvd01zIH0gYXMgY29uc3Q7XG4gIH1cblxuICBpZiAoY3VycmVudC5jb3VudCA+PSBsaW1pdCkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCByZW1haW5pbmc6IDAsIHJlc2V0SW46IGN1cnJlbnQuZXhwaXJlc0F0IC0gbm93VHMgfSBhcyBjb25zdDtcbiAgfVxuXG4gIGN1cnJlbnQuY291bnQgKz0gMTtcbiAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgcmVtYWluaW5nOiBsaW1pdCAtIGN1cnJlbnQuY291bnQsIHJlc2V0SW46IGN1cnJlbnQuZXhwaXJlc0F0IC0gbm93VHMgfSBhcyBjb25zdDtcbn07XG4iXSwibmFtZXMiOlsid2luZG93cyIsIm5vdyIsIkRhdGUiLCJyYXRlTGltaXQiLCJpZGVudGlmaWVyIiwibGltaXQiLCJOdW1iZXIiLCJwcm9jZXNzIiwiZW52IiwiUkFURV9MSU1JVF9NQVhfUkVRVUVTVFMiLCJ3aW5kb3dNcyIsIlJBVEVfTElNSVRfV0lORE9XX01TIiwia2V5IiwiY3VycmVudCIsIm5vd1RzIiwiZXhwaXJlc0F0IiwiY291bnQiLCJzdWNjZXNzIiwicmVtYWluaW5nIiwicmVzZXRJbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/rateLimit.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/tools.ts":
/*!*****************************!*\
  !*** ./src/server/tools.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addToReadingList: () => (/* binding */ addToReadingList),\n/* harmony export */   getBookDetails: () => (/* binding */ getBookDetails),\n/* harmony export */   getReadingList: () => (/* binding */ getReadingList),\n/* harmony export */   getReadingStats: () => (/* binding */ getReadingStats),\n/* harmony export */   markAsRead: () => (/* binding */ markAsRead),\n/* harmony export */   searchBooks: () => (/* binding */ searchBooks)\n/* harmony export */ });\n/* harmony import */ var _datastore__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastore */ \"(rsc)/./src/server/datastore.ts\");\n/* harmony import */ var _googleBooks__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./googleBooks */ \"(rsc)/./src/server/googleBooks.ts\");\n/* harmony import */ var _validation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./validation */ \"(rsc)/./src/server/validation.ts\");\n\n\n\nconst getGoogleBooksKey = ()=>process.env.GOOGLE_BOOKS_API_KEY;\nasync function searchBooks(body) {\n    const { query, maxResults, orderBy } = _validation__WEBPACK_IMPORTED_MODULE_2__.searchBooksSchema.parse(body);\n    const apiKey = getGoogleBooksKey();\n    const results = await (0,_googleBooks__WEBPACK_IMPORTED_MODULE_1__.searchBooks)(query, maxResults, orderBy, apiKey);\n    return {\n        results\n    };\n}\nasync function getBookDetails(body) {\n    const { bookId } = _validation__WEBPACK_IMPORTED_MODULE_2__.getBookDetailsSchema.parse(body);\n    const apiKey = getGoogleBooksKey();\n    const details = await (0,_googleBooks__WEBPACK_IMPORTED_MODULE_1__.fetchBookDetails)(bookId, apiKey);\n    return {\n        details\n    };\n}\nasync function addToReadingList(body, userId) {\n    const { bookId, priority, notes } = _validation__WEBPACK_IMPORTED_MODULE_2__.addToReadingListSchema.parse(body);\n    const apiKey = getGoogleBooksKey();\n    const details = await (0,_googleBooks__WEBPACK_IMPORTED_MODULE_1__.fetchBookDetails)(bookId, apiKey);\n    const added = (0,_datastore__WEBPACK_IMPORTED_MODULE_0__.addBook)(userId, {\n        bookId,\n        priority,\n        notes,\n        addedAt: new Date().toISOString(),\n        status: 'pending',\n        title: details.title,\n        authors: details.authors,\n        thumbnail: details.thumbnail\n    });\n    return added;\n}\nasync function getReadingList(body, userId) {\n    const { filter, limit } = _validation__WEBPACK_IMPORTED_MODULE_2__.getReadingListSchema.parse(body);\n    const items = (0,_datastore__WEBPACK_IMPORTED_MODULE_0__.listBooks)(userId, filter === 'all' ? undefined : filter, limit);\n    return {\n        items\n    };\n}\nasync function markAsRead(body, userId) {\n    const { bookId, rating, review, dateFinished } = _validation__WEBPACK_IMPORTED_MODULE_2__.markAsReadSchema.parse(body);\n    const apiKey = getGoogleBooksKey();\n    const details = await (0,_googleBooks__WEBPACK_IMPORTED_MODULE_1__.fetchBookDetails)(bookId, apiKey);\n    const updated = (0,_datastore__WEBPACK_IMPORTED_MODULE_0__.markBookAsRead)(userId, bookId, rating, review, dateFinished, details);\n    return updated ? {\n        success: true\n    } : {\n        success: false,\n        reason: 'Libro no encontrado en la lista'\n    };\n}\nasync function getReadingStats(body, userId) {\n    const { period, groupBy } = _validation__WEBPACK_IMPORTED_MODULE_2__.readingStatsSchema.parse(body);\n    const stats = (0,_datastore__WEBPACK_IMPORTED_MODULE_0__.getStats)(userId, period);\n    const breakdown = groupBy === 'author' ? stats.authors : groupBy === 'year' ? Object.keys(stats.byPeriod).reduce((acc, key)=>{\n        if (key === 'unknown') return acc;\n        const year = key.slice(0, 4);\n        acc[year] = (acc[year] || 0) + stats.byPeriod[key];\n        return acc;\n    }, {}) : stats.genres;\n    return {\n        period,\n        groupBy,\n        stats,\n        breakdown\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU1JLFFBQVEsQ0FBQ0csSUFBSTtRQUNsRCxPQUFPRDtJQUNULEdBQUcsQ0FBQyxLQUNKTixNQUFNVSxNQUFNO0lBRXBCLE9BQU87UUFBRVo7UUFBUUM7UUFBU0M7UUFBT0M7SUFBVTtBQUM3QyIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWJvb2stYWR2aXNvci8uL3NyYy9zZXJ2ZXIvdG9vbHMudHM/Nzg1YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhZGRCb29rLCBnZXRTdGF0cywgbGlzdEJvb2tzLCBtYXJrQm9va0FzUmVhZCB9IGZyb20gJy4vZGF0YXN0b3JlJztcbmltcG9ydCB7IGZldGNoQm9va0RldGFpbHMsIHNlYXJjaEJvb2tzIGFzIHNlYXJjaEdvb2dsZUJvb2tzIH0gZnJvbSAnLi9nb29nbGVCb29rcyc7XG5pbXBvcnQge1xuICBhZGRUb1JlYWRpbmdMaXN0U2NoZW1hLFxuICBnZXRCb29rRGV0YWlsc1NjaGVtYSxcbiAgZ2V0UmVhZGluZ0xpc3RTY2hlbWEsXG4gIG1hcmtBc1JlYWRTY2hlbWEsXG4gIHJlYWRpbmdTdGF0c1NjaGVtYSxcbiAgc2VhcmNoQm9va3NTY2hlbWEsXG59IGZyb20gJy4vdmFsaWRhdGlvbic7XG5cbmNvbnN0IGdldEdvb2dsZUJvb2tzS2V5ID0gKCkgPT4gcHJvY2Vzcy5lbnYuR09PR0xFX0JPT0tTX0FQSV9LRVk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2hCb29rcyhib2R5OiB1bmtub3duKSB7XG4gIGNvbnN0IHsgcXVlcnksIG1heFJlc3VsdHMsIG9yZGVyQnkgfSA9IHNlYXJjaEJvb2tzU2NoZW1hLnBhcnNlKGJvZHkpO1xuICBjb25zdCBhcGlLZXkgPSBnZXRHb29nbGVCb29rc0tleSgpO1xuICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VhcmNoR29vZ2xlQm9va3MocXVlcnksIG1heFJlc3VsdHMsIG9yZGVyQnksIGFwaUtleSk7XG4gIHJldHVybiB7IHJlc3VsdHMgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEJvb2tEZXRhaWxzKGJvZHk6IHVua25vd24pIHtcbiAgY29uc3QgeyBib29rSWQgfSA9IGdldEJvb2tEZXRhaWxzU2NoZW1hLnBhcnNlKGJvZHkpO1xuICBjb25zdCBhcGlLZXkgPSBnZXRHb29nbGVCb29rc0tleSgpO1xuICBjb25zdCBkZXRhaWxzID0gYXdhaXQgZmV0Y2hCb29rRGV0YWlscyhib29rSWQsIGFwaUtleSk7XG4gIHJldHVybiB7IGRldGFpbHMgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZFRvUmVhZGluZ0xpc3QoYm9keTogdW5rbm93biwgdXNlcklkOiBzdHJpbmcpIHtcbiAgY29uc3QgeyBib29rSWQsIHByaW9yaXR5LCBub3RlcyB9ID0gYWRkVG9SZWFkaW5nTGlzdFNjaGVtYS5wYXJzZShib2R5KTtcbiAgY29uc3QgYXBpS2V5ID0gZ2V0R29vZ2xlQm9va3NLZXkoKTtcbiAgY29uc3QgZGV0YWlscyA9IGF3YWl0IGZldGNoQm9va0RldGFpbHMoYm9va0lkLCBhcGlLZXkpO1xuXG4gIGNvbnN0IGFkZGVkID0gYWRkQm9vayh1c2VySWQsIHtcbiAgICBib29rSWQsXG4gICAgcHJpb3JpdHksXG4gICAgbm90ZXMsXG4gICAgYWRkZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgIHRpdGxlOiBkZXRhaWxzLnRpdGxlLFxuICAgIGF1dGhvcnM6IGRldGFpbHMuYXV0aG9ycyxcbiAgICB0aHVtYm5haWw6IGRldGFpbHMudGh1bWJuYWlsLFxuICB9KTtcbiAgcmV0dXJuIGFkZGVkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVhZGluZ0xpc3QoYm9keTogdW5rbm93biwgdXNlcklkOiBzdHJpbmcpIHtcbiAgY29uc3QgeyBmaWx0ZXIsIGxpbWl0IH0gPSBnZXRSZWFkaW5nTGlzdFNjaGVtYS5wYXJzZShib2R5KTtcbiAgY29uc3QgaXRlbXMgPSBsaXN0Qm9va3ModXNlcklkLCBmaWx0ZXIgPT09ICdhbGwnID8gdW5kZWZpbmVkIDogZmlsdGVyLCBsaW1pdCk7XG4gIHJldHVybiB7IGl0ZW1zIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYXJrQXNSZWFkKGJvZHk6IHVua25vd24sIHVzZXJJZDogc3RyaW5nKSB7XG4gIGNvbnN0IHsgYm9va0lkLCByYXRpbmcsIHJldmlldywgZGF0ZUZpbmlzaGVkIH0gPSBtYXJrQXNSZWFkU2NoZW1hLnBhcnNlKGJvZHkpO1xuICBjb25zdCBhcGlLZXkgPSBnZXRHb29nbGVCb29rc0tleSgpO1xuICBjb25zdCBkZXRhaWxzID0gYXdhaXQgZmV0Y2hCb29rRGV0YWlscyhib29rSWQsIGFwaUtleSk7XG4gIGNvbnN0IHVwZGF0ZWQgPSBtYXJrQm9va0FzUmVhZCh1c2VySWQsIGJvb2tJZCwgcmF0aW5nLCByZXZpZXcsIGRhdGVGaW5pc2hlZCwgZGV0YWlscyk7XG4gIHJldHVybiB1cGRhdGVkID8geyBzdWNjZXNzOiB0cnVlIH0gOiB7IHN1Y2Nlc3M6IGZhbHNlLCByZWFzb246ICdMaWJybyBubyBlbmNvbnRyYWRvIGVuIGxhIGxpc3RhJyB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVhZGluZ1N0YXRzKGJvZHk6IHVua25vd24sIHVzZXJJZDogc3RyaW5nKSB7XG4gIGNvbnN0IHsgcGVyaW9kLCBncm91cEJ5IH0gPSByZWFkaW5nU3RhdHNTY2hlbWEucGFyc2UoYm9keSk7XG4gIGNvbnN0IHN0YXRzID0gZ2V0U3RhdHModXNlcklkLCBwZXJpb2QpO1xuICBjb25zdCBicmVha2Rvd24gPVxuICAgIGdyb3VwQnkgPT09ICdhdXRob3InXG4gICAgICA/IHN0YXRzLmF1dGhvcnNcbiAgICAgIDogZ3JvdXBCeSA9PT0gJ3llYXInXG4gICAgICAgID8gT2JqZWN0LmtleXMoc3RhdHMuYnlQZXJpb2QpLnJlZHVjZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PigoYWNjLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICd1bmtub3duJykgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIGNvbnN0IHllYXIgPSBrZXkuc2xpY2UoMCwgNCk7XG4gICAgICAgICAgICBhY2NbeWVhcl0gPSAoYWNjW3llYXJdIHx8IDApICsgc3RhdHMuYnlQZXJpb2Rba2V5XTtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30pXG4gICAgICAgIDogc3RhdHMuZ2VucmVzO1xuXG4gIHJldHVybiB7IHBlcmlvZCwgZ3JvdXBCeSwgc3RhdHMsIGJyZWFrZG93biB9O1xufVxuIl0sIm5hbWVzIjpbImFkZEJvb2siLCJnZXRTdGF0cyIsImxpc3RCb29rcyIsIm1hcmtCb29rQXNSZWFkIiwiZmV0Y2hCb29rRGV0YWlscyIsInNlYXJjaEJvb2tzIiwic2VhcmNoR29vZ2xlQm9va3MiLCJhZGRUb1JlYWRpbmdMaXN0U2NoZW1hIiwiZ2V0Qm9va0RldGFpbHNTY2hlbWEiLCJnZXRSZWFkaW5nTGlzdFNjaGVtYSIsIm1hcmtBc1JlYWRTY2hlbWEiLCJyZWFkaW5nU3RhdHNTY2hlbWEiLCJzZWFyY2hCb29rc1NjaGVtYSIsImdldEdvb2dsZUJvb2tzS2V5IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9CT09LU19BUElfS0VZIiwiYm9keSIsInF1ZXJ5IiwibWF4UmVzdWx0cyIsIm9yZGVyQnkiLCJwYXJzZSIsImFwaUtleSIsInJlc3VsdHMiLCJnZXRCb29rRGV0YWlscyIsImJvb2tJZCIsImRldGFpbHMiLCJhZGRUb1JlYWRpbmdMaXN0IiwidXNlcklkIiwicHJpb3JpdHkiLCJub3RlcyIsImFkZGVkIiwiYWRkZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInN0YXR1cyIsInRpdGxlIiwiYXV0aG9ycyIsInRodW1ibmFpbCIsImdldFJlYWRpbmdMaXN0IiwiZmlsdGVyIiwibGltaXQiLCJpdGVtcyIsInVuZGVmaW5lZCIsIm1hcmtBc1JlYWQiLCJyYXRpbmciLCJyZXZpZXciLCJkYXRlRmluaXNoZWQiLCJ1cGRhdGVkIiwic3VjY2VzcyIsInJlYXNvbiIsImdldFJlYWRpbmdTdGF0cyIsInBlcmlvZCIsImdyb3VwQnkiLCJzdGF0cyIsImJyZWFrZG93biIsIk9iamVjdCIsImtleXMiLCJieVBlcmlvZCIsInJlZHVjZSIsImFjYyIsImtleSIsInllYXIiLCJzbGljZSIsImdlbnJlcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/server/tools.ts\n");

/***/ }),

/***/ "(rsc)/./src/server/validation.ts":
/*!**********************************!*\
  !*** ./src/server/validation.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addToReadingListSchema: () => (/* binding */ addToReadingListSchema),\n/* harmony export */   getBookDetailsSchema: () => (/* binding */ getBookDetailsSchema),\n/* harmony export */   getReadingListSchema: () => (/* binding */ getReadingListSchema),\n/* harmony export */   markAsReadSchema: () => (/* binding */ markAsReadSchema),\n/* harmony export */   readingStatsSchema: () => (/* binding */ readingStatsSchema),\n/* harmony export */   sanitizeQuery: () => (/* binding */ sanitizeQuery),\n/* harmony export */   searchBooksSchema: () => (/* binding */ searchBooksSchema)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js\");\n\nconst searchBooksSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    query: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(2, 'La búsqueda debe tener al menos 2 caracteres').max(100).trim(),\n    maxResults: zod__WEBPACK_IMPORTED_MODULE_0__.number().int().min(1).max(40).optional().default(10),\n    orderBy: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        'relevance',\n        'newest'\n    ]).optional().default('relevance')\n});\nconst getBookDetailsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    bookId: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1).max(120).trim()\n});\nconst addToReadingListSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    bookId: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1).max(120).trim(),\n    priority: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        'high',\n        'medium',\n        'low'\n    ]).optional().default('medium'),\n    notes: zod__WEBPACK_IMPORTED_MODULE_0__.string().max(400).optional().transform((value)=>value?.replace(/[<>]/g, '').trim() || undefined)\n});\nconst getReadingListSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    filter: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        'high',\n        'medium',\n        'low',\n        'all'\n    ]).optional().default('all'),\n    limit: zod__WEBPACK_IMPORTED_MODULE_0__.number().int().min(1).max(50).optional().default(20)\n});\nconst markAsReadSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    bookId: zod__WEBPACK_IMPORTED_MODULE_0__.string().min(1).max(120).trim(),\n    rating: zod__WEBPACK_IMPORTED_MODULE_0__.number().int().min(1).max(5).optional(),\n    review: zod__WEBPACK_IMPORTED_MODULE_0__.string().max(800).optional().transform((value)=>value?.trim() || undefined),\n    dateFinished: zod__WEBPACK_IMPORTED_MODULE_0__.string().optional()\n});\nconst readingStatsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.object({\n    period: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        'all-time',\n        'year',\n        'month',\n        'week'\n    ]).optional().default('all-time'),\n    groupBy: zod__WEBPACK_IMPORTED_MODULE_0__[\"enum\"]([\n        'genre',\n        'author',\n        'year'\n    ]).optional().default('genre')\n});\nconst sanitizeQuery = (value)=>value.replace(/[<>]/g, '').trim();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmVyL3ZhbGlkYXRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBd0I7QUFFakIsTUFBTUMsb0JBQW9CRCx1Q0FBUSxDQUFDO0lBQ3hDRyxPQUFPSCx1Q0FBUSxHQUFHSyxHQUFHLENBQUMsR0FBRyxnREFBZ0RDLEdBQUcsQ0FBQyxLQUFLQyxJQUFJO0lBQ3RGQyxZQUFZUix1Q0FBUSxHQUFHVSxHQUFHLEdBQUdMLEdBQUcsQ0FBQyxHQUFHQyxHQUFHLENBQUMsSUFBSUssUUFBUSxHQUFHQyxPQUFPLENBQUM7SUFDL0RDLFNBQVNiLHdDQUFNLENBQUM7UUFBQztRQUFhO0tBQVMsRUFBRVcsUUFBUSxHQUFHQyxPQUFPLENBQUM7QUFDOUQsR0FBRztBQUVJLE1BQU1HLHVCQUF1QmYsdUNBQVEsQ0FBQztJQUMzQ2dCLFFBQVFoQix1Q0FBUSxHQUFHSyxHQUFHLENBQUMsR0FBR0MsR0FBRyxDQUFDLEtBQUtDLElBQUk7QUFDekMsR0FBRztBQUVJLE1BQU1VLHlCQUF5QmpCLHVDQUFRLENBQUM7SUFDN0NnQixRQUFRaEIsdUNBQVEsR0FBR0ssR0FBRyxDQUFDLEdBQUdDLEdBQUcsQ0FBQyxLQUFLQyxJQUFJO0lBQ3ZDVyxVQUFVbEIsd0NBQU0sQ0FBQztRQUFDO1FBQVE7UUFBVTtLQUFNLEVBQUVXLFFBQVEsR0FBR0MsT0FBTyxDQUFDO0lBQy9ETyxPQUFPbkIsdUNBQ0UsR0FDTk0sR0FBRyxDQUFDLEtBQ0pLLFFBQVEsR0FDUlMsU0FBUyxDQUFDLENBQUNDLFFBQVVBLE9BQU9DLFFBQVEsU0FBUyxJQUFJZixVQUFVZ0I7QUFDaEUsR0FBRztBQUVJLE1BQU1DLHVCQUF1QnhCLHVDQUFRLENBQUM7SUFDM0N5QixRQUFRekIsd0NBQU0sQ0FBQztRQUFDO1FBQVE7UUFBVTtRQUFPO0tBQU0sRUFBRVcsUUFBUSxHQUFHQyxPQUFPLENBQUM7SUFDcEVjLE9BQU8xQix1Q0FBUSxHQUFHVSxHQUFHLEdBQUdMLEdBQUcsQ0FBQyxHQUFHQyxHQUFHLENBQUMsSUFBSUssUUFBUSxHQUFHQyxPQUFPLENBQUM7QUFDNUQsR0FBRztBQUVJLE1BQU1lLG1CQUFtQjNCLHVDQUFRLENBQUM7SUFDdkNnQixRQUFRaEIsdUNBQVEsR0FBR0ssR0FBRyxDQUFDLEdBQUdDLEdBQUcsQ0FBQyxLQUFLQyxJQUFJO0lBQ3ZDcUIsUUFBUTVCLHVDQUFRLEdBQUdVLEdBQUcsR0FBR0wsR0FBRyxDQUFDLEdBQUdDLEdBQUcsQ0FBQyxHQUFHSyxRQUFRO0lBQy9Da0IsUUFBUTdCLHVDQUFRLEdBQUdNLEdBQUcsQ0FBQyxLQUFLSyxRQUFRLEdBQUdTLFNBQVMsQ0FBQyxDQUFDQyxRQUFVQSxPQUFPZCxVQUFVZ0I7SUFDN0VPLGNBQWM5Qix1Q0FBUSxHQUFHVyxRQUFRO0FBQ25DLEdBQUc7QUFFSSxNQUFNb0IscUJBQXFCL0IsdUNBQVEsQ0FBQztJQUN6Q2dDLFFBQVFoQyx3Q0FBTSxDQUFDO1FBQUM7UUFBWTtRQUFRO1FBQVM7S0FBTyxFQUFFVyxRQUFRLEdBQUdDLE9BQU8sQ0FBQztJQUN6RXFCLFNBQVNqQyx3Q0FBTSxDQUFDO1FBQUM7UUFBUztRQUFVO0tBQU8sRUFBRVcsUUFBUSxHQUFHQyxPQUFPLENBQUM7QUFDbEUsR0FBRztBQUVJLE1BQU1zQixnQkFBZ0IsQ0FBQ2IsUUFBa0JBLE1BQU1DLE9BQU8sQ0FBQyxTQUFTLElBQUlmLElBQUksR0FBRyIsInNvdXJjZXMiOlsid2VicGFjazovL2FpLWJvb2stYWR2aXNvci8uL3NyYy9zZXJ2ZXIvdmFsaWRhdGlvbi50cz9mZGY2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG5leHBvcnQgY29uc3Qgc2VhcmNoQm9va3NTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHF1ZXJ5OiB6LnN0cmluZygpLm1pbigyLCAnTGEgYsO6c3F1ZWRhIGRlYmUgdGVuZXIgYWwgbWVub3MgMiBjYXJhY3RlcmVzJykubWF4KDEwMCkudHJpbSgpLFxuICBtYXhSZXN1bHRzOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoNDApLm9wdGlvbmFsKCkuZGVmYXVsdCgxMCksXG4gIG9yZGVyQnk6IHouZW51bShbJ3JlbGV2YW5jZScsICduZXdlc3QnXSkub3B0aW9uYWwoKS5kZWZhdWx0KCdyZWxldmFuY2UnKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgZ2V0Qm9va0RldGFpbHNTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJvb2tJZDogei5zdHJpbmcoKS5taW4oMSkubWF4KDEyMCkudHJpbSgpLFxufSk7XG5cbmV4cG9ydCBjb25zdCBhZGRUb1JlYWRpbmdMaXN0U2NoZW1hID0gei5vYmplY3Qoe1xuICBib29rSWQ6IHouc3RyaW5nKCkubWluKDEpLm1heCgxMjApLnRyaW0oKSxcbiAgcHJpb3JpdHk6IHouZW51bShbJ2hpZ2gnLCAnbWVkaXVtJywgJ2xvdyddKS5vcHRpb25hbCgpLmRlZmF1bHQoJ21lZGl1bScpLFxuICBub3RlczogelxuICAgIC5zdHJpbmcoKVxuICAgIC5tYXgoNDAwKVxuICAgIC5vcHRpb25hbCgpXG4gICAgLnRyYW5zZm9ybSgodmFsdWUpID0+IHZhbHVlPy5yZXBsYWNlKC9bPD5dL2csICcnKS50cmltKCkgfHwgdW5kZWZpbmVkKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgZ2V0UmVhZGluZ0xpc3RTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGZpbHRlcjogei5lbnVtKFsnaGlnaCcsICdtZWRpdW0nLCAnbG93JywgJ2FsbCddKS5vcHRpb25hbCgpLmRlZmF1bHQoJ2FsbCcpLFxuICBsaW1pdDogei5udW1iZXIoKS5pbnQoKS5taW4oMSkubWF4KDUwKS5vcHRpb25hbCgpLmRlZmF1bHQoMjApLFxufSk7XG5cbmV4cG9ydCBjb25zdCBtYXJrQXNSZWFkU2NoZW1hID0gei5vYmplY3Qoe1xuICBib29rSWQ6IHouc3RyaW5nKCkubWluKDEpLm1heCgxMjApLnRyaW0oKSxcbiAgcmF0aW5nOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoNSkub3B0aW9uYWwoKSxcbiAgcmV2aWV3OiB6LnN0cmluZygpLm1heCg4MDApLm9wdGlvbmFsKCkudHJhbnNmb3JtKCh2YWx1ZSkgPT4gdmFsdWU/LnRyaW0oKSB8fCB1bmRlZmluZWQpLFxuICBkYXRlRmluaXNoZWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5leHBvcnQgY29uc3QgcmVhZGluZ1N0YXRzU2NoZW1hID0gei5vYmplY3Qoe1xuICBwZXJpb2Q6IHouZW51bShbJ2FsbC10aW1lJywgJ3llYXInLCAnbW9udGgnLCAnd2VlayddKS5vcHRpb25hbCgpLmRlZmF1bHQoJ2FsbC10aW1lJyksXG4gIGdyb3VwQnk6IHouZW51bShbJ2dlbnJlJywgJ2F1dGhvcicsICd5ZWFyJ10pLm9wdGlvbmFsKCkuZGVmYXVsdCgnZ2VucmUnKSxcbn0pO1xuXG5leHBvcnQgY29uc3Qgc2FuaXRpemVRdWVyeSA9ICh2YWx1ZTogc3RyaW5nKSA9PiB2YWx1ZS5yZXBsYWNlKC9bPD5dL2csICcnKS50cmltKCk7XG4iXSwibmFtZXMiOlsieiIsInNlYXJjaEJvb2tzU2NoZW1hIiwib2JqZWN0IiwicXVlcnkiLCJzdHJpbmciLCJtaW4iLCJtYXgiLCJ0cmltIiwibWF4UmVzdWx0cyIsIm51bWJlciIsImludCIsIm9wdGlvbmFsIiwiZGVmYXVsdCIsIm9yZGVyQnkiLCJlbnVtIiwiZ2V0Qm9va0RldGFpbHNTY2hlbWEiLCJib29rSWQiLCJhZGRUb1JlYWRpbmdMaXN0U2NoZW1hIiwicHJpb3JpdHkiLCJub3RlcyIsInRyYW5zZm9ybSIsInZhbHVlIiwicmVwbGFjZSIsInVuZGVmaW5lZCIsImdldFJlYWRpbmdMaXN0U2NoZW1hIiwiZmlsdGVyIiwibGltaXQiLCJtYXJrQXNSZWFkU2NoZW1hIiwicmF0aW5nIiwicmV2aWV3IiwiZGF0ZUZpbmlzaGVkIiwicmVhZGluZ1N0YXRzU2NoZW1hIiwicGVyaW9kIiwiZ3JvdXBCeSIsInNhbml0aXplUXVlcnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/server/validation.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61","vendor-chunks/zod@3.25.76","vendor-chunks/@opentelemetry+api@1.9.0"], () => (__webpack_exec__("(rsc)/./node_modules/.pnpm/next@15.0.0-canary.0_@opentelemetry+api@1.9.0_react-dom@19.0.0-rc-f994737d14-20240522_r_bd2ed8a7d5b06457690d27bde0a81d61/node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftools%2F%5Btool%5D%2Froute&page=%2Fapi%2Ftools%2F%5Btool%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftools%2F%5Btool%5D%2Froute.ts&appDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Feke%2FDocuments%2FUap%2FProgra%204%2FProgra-3-4&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();